/*! CoursePress - v3.0.0
 * https://premium.wpmudev.org/project/coursepress-pro/
 * Copyright (c) 2017; * Licensed GPLv2+ */
!function(){"use strict";CoursePress.Define("NotificationEmails",function(a,b,c){return CoursePress.View.extend({template_id:"coursepress-notification-emails-tpl",el:a("#notification-emails"),events:{"change #cp-course":"getUnitsStudents","change #cp-unit":"getStudents","click #cp-add-student-btn":"selectStudent","click ul#cp-notifications-students li":"unSelectStudent","click .cp-send-email":"sendEmail"},initialize:function(){this.request=new CoursePress.Request,this.on("view_rendered",this.setUpUI,this),this.request.on("coursepress:success_get_notification_units_students",this.updateUnitsStudents,this),this.request.on("coursepress:success_get_notification_students",this.updateStudents,this),this.render()},setUpUI:function(){this.$("#cp-course").select2({width:"100%"}),this.$("#cp-unit, #cp-student").select2({width:"100%",data:[]})},getUnitsStudents:function(b){var c=a(b.currentTarget).val();""!==c&&(this.request.set({action:"get_notification_units_students",course_id:c}),this.request.save())},getStudents:function(){var a=this.$("#cp-unit").val();"0"!==a&&""!==a&&(this.request.set({action:"get_notification_students",unit_id:a}),this.request.save())},updateUnitsStudents:function(a){this.$("#cp-unit").empty().select2({data:_.isEmpty(a.units)?[]:a.units}),this.updateStudents(a)},updateStudents:function(a){this.$("#cp-student").empty().select2({data:_.isEmpty(a.students)?[]:a.students})},selectStudent:function(){var a=this.$("#cp-student").val(),b=this.$("#cp-student :selected").text();_.isEmpty(a)||_.isEmpty(b)||this.setSelectedStudents(a,b)},unSelectStudent:function(b){a(b.currentTarget).remove(),0===this.$("#cp-notifications-students li").length&&this.setSelectedStudents(0,c._coursepress.text.all_students)},setSelectedStudents:function(a,b){this.$("ul#cp-notifications-students").append('<li data-user-id="'+a+'">'+b+"</li>")},sendEmail:function(b){this.$(b.currentTarget).addClass("cp-progress");var d=c.tinymce.editors.notification_content.getContent(),e=this.$("#notification-title").val(),f=[],g=this.$("#cp-notifications-students li");0!==g.length&&g.each(function(){void 0!==a(this).data("user-id")&&f.push(a(this).data("user-id"))}),_.isEmpty(f)||(this.request.set({action:"send_notification_email",students:f,title:e,content:d}),this.request.on("coursepress:success_send_notification_email",this.afterEmail,this),this.request.on("coursepress:error_send_notification_email",this.afterEmail,this),this.request.save())},afterEmail:function(){this.$(".cp-send-email").removeClass("cp-progress")}})})}(),function(){"use strict";CoursePress.Define("NotificationAlerts",function(a){return CoursePress.View.extend({template_id:"coursepress-notification-alerts-tpl",el:a("#notification-alerts"),events:{"change .cp-toggle-alert-status":"toggleAlertStatus"},initialize:function(){this.request=new CoursePress.Request,this.request.on("coursepress:error_alert_status_toggle",this.revertStatusToggle,this),this.render()},toggleAlertStatus:function(b){this.request.selector=a(b.target);var c=this.request.selector.prop("checked")?"publish":"draft";this.request.set({action:"alert_status_toggle",alert_id:this.request.selector.val(),status:c}),this.request.save()},revertStatusToggle:function(){var a=this.request.selector.prop("checked");this.request.selector.prop("checked",!a)}})})}(),function(){"use strict";CoursePress.Define("NotificationAlertsForm",function(a,b,c){return CoursePress.View.extend({template_id:"coursepress-notification-alerts-form-tpl",el:a("#notification-alerts_form"),events:{"click .cp-alert-submit":"createAlert","click .cp-alert-cancel":"clearForm"},initialize:function(){this.request=new CoursePress.Request,this.on("view_rendered",this.setUpUI,this),this.request.on("coursepress:success_create_course_alert",this.showSuccess,this),this.request.on("coursepress:error_create_course_alert",this.showError,this),this.render()},setUpUI:function(){this.$("select").select2({width:"100%"})},createAlert:function(a){this.$(a.currentTarget).addClass("cp-progress");var b=c.tinymce.editors.alert_content.getContent(),d=this.$("#alert-title").val(),e=this.$("#cp-alert-course").val();""!==b&&""!==d&&""!==e&&(this.request.set({action:"create_course_alert",course_id:e,title:d,content:b}),this.request.save())},showSuccess:function(){this.$(".cp-alert-submit").removeClass("cp-progress"),this.clearForm()},showError:function(){this.$(".cp-alert-submit").removeClass("cp-progress")},clearForm:function(){c.tinymce.editors.alert_content.setContent(""),this.$("#alert-title").val("")}})})}(),function(){"use strict";CoursePress.Define("Notification",function(a){var b;b=CoursePress.View.extend({el:a("#coursepress-notifications"),currentPage:"emails",currentTab:"emails",events:{"click .cp-notification-menu-item":"setNotificationPage"},initialize:function(){this.once("coursepress:notification_emails",this.getEmailsView,this),this.once("coursepress:notification_alerts",this.getAlertsView,this),this.once("coursepress:notification_alerts_form",this.getAlertsFormView,this),CoursePress.View.prototype.initialize.apply(this,arguments)},render:function(){this.on("coursepress:notification",this.setCurrentPage,this),this.setPage(this.currentPage,this.currentTab)},setCurrentPage:function(){this.currentMenu=this.$(".cp-notification-menu-item.notification-"+this.currentTab),this.currentView=this.$("#notification-"+this.currentPage),this.currentMenu.addClass("active"),this.currentMenu.siblings().removeClass("active"),this.currentView.removeClass("inactive"),this.currentView.siblings().addClass("inactive")},setPage:function(a,b){this.currentPage=a,this.currentTab=b,this.trigger("coursepress:notification",a,b),this.trigger("coursepress:notification_"+a)},setNotificationPage:function(b){var c=a(b.currentTarget),d=c.data("page"),e=c.data("tab");this.setPage(d,e)},getEmailsView:function(){new CoursePress.NotificationEmails},getAlertsView:function(){new CoursePress.NotificationAlerts},getAlertsFormView:function(){new CoursePress.NotificationAlertsForm}}),b=new b})}();