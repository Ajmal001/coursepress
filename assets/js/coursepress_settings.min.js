/*! CoursePress - v3.0.0
 * https://premium.wpmudev.org/project/coursepress-pro/
 * Copyright (c) 2017; * Licensed GPLv2+ */
!function(){"use strict";CoursePress.Define("GeneralSettings",function(a){return CoursePress.View.extend({template_id:"coursepress-general-setting-tpl",el:a("#coursepress-setting-general"),initialize:function(a){this.model=a,this.on("view_rendered",this.setUpUI,this),this.render()},setUpUI:function(){this.$("select").select2()},getModel:function(){return window.console.log(this.model),this.model}})})}(),function(){"use strict";CoursePress.Define("SlugsSettings",function(a){return CoursePress.View.extend({template_id:"coursepress-slugs-setting-tpl",el:a("#coursepress-setting-slugs"),events:{"change [name]":"updateModel"},initialize:function(a,b){this.model=a||{},this.settingView=b,this.on("view_rendered",this.setUpUI,this),this.render()},setUpUI:function(){this.$("select").select2()},updateModel:function(b){var c,d,e=a(b.currentTarget),f=e.attr("name"),g=e.val();e.is('[type="checkbox"],[type="radio"]')&&(g=!!e.is(":checked")&&g),f=f.split("."),c=f.shift(),d=this.model[c]?this.model[c]:{},f.length?(_.each(f,function(a){d[a]=g},this),this.model[c]=d):this.model[c]=g},getModel:function(){return window.console.log("slugs"),window.console.log(this.model),this.model}})})}(),function(){"use strict";CoursePress.Define("EmailSettings",function(a,b,c){return CoursePress.View.extend({template_id:"coursepress-emails-setting-tpl",el:a("#coursepress-setting-email"),events:{"change [name]":"updateModel","click .cp-input-group li":"toggleBox"},rootModel:!1,editor:!1,current:"registration",model:{enabled:1,from:"",email:"",subject:"",content:"",auto_email:!1},initialize:function(a){this.rootModel=a,this.on("view_rendered",this.setUpUI,this),this.render()},setUpUI:function(){this.$(".cp-input-group li").first().trigger("click")},toggleBox:function(b){var c=a(b.currentTarget),d=c.data("key");this.current=d,this.rootModel[d]&&(this.model=this.rootModel[d],this.setValues(this.model)),c.siblings().removeClass("active"),c.addClass("active")},setValues:function(b){var d,e;if(d=this.$("[name]"),e=this,this.visualEditor({content:this.rootModel[this.current].content,container:this.$(".coursepress-email-content").empty(),callback:function(a){e.rootModel[e.current].content=a}}),_.each(d,function(c){var d=a(c),e=d.attr("name");b[e]&&d.val(b[e])},this),c._coursepress.email_sections[this.current]){var f=c._coursepress.email_sections[this.current];this.$("#course-email-heading").html(f.title),this.$("#course-email-desc").html(f.description),this.$(".cp-alert-info").html(f.content_help_text),this.$('[name="enabled"]').prop("checked",!!this.rootModel[this.current].enabled)}},getModel:function(){return this.rootModel},updateModel:function(a){var b=this.$(a.currentTarget),c=b.val(),d=b.attr("name");"checkbox"===b.attr("type")&&(c=!!b.is(":checked")&&c),this.model[d]=c,this.rootModel[this.current]=this.model}})})}(),function(){"use strict";CoursePress.Define("CapabilitiesSettings",function(a){return CoursePress.View.extend({template_id:"coursepress-capabilities-setting-tpl",el:a("#coursepress-setting-capabilities"),events:{"click .cp-select-list.cp-capabilities li":"showHideCaps","change [name]":"updateModel"},current:"instructor",initialize:function(a){this.model=a,this.render()},updateModel:function(b){var c=a(b.currentTarget),d=c.attr("name"),e=c.val();c.is('[type="checkbox"],[type="radio"]')&&(e=!!c.is(":checked")&&e),this.model[this.current]||(this.model[this.current]={}),this.model[this.current][d]=e},getModel:function(){return window.console.log(this.model),this.model},showHideCaps:function(b){var c=a(b.currentTarget),d=c.data("id");this.setActiveItem(c),this.$(".cp-caps-fields").addClass("inactive"),this.$("#"+d).removeClass("inactive")},setActiveItem:function(a){a.siblings().removeClass("active"),a.addClass("active")}})})}(),function(){"use strict";CoursePress.Define("CertificateSettings",function(a,b){var c,d;return a(b).on("click",function(b){var d=a(b.currentTarget);!c||d.is(c)&&d.is(".iris-picker")||(c.iris("hide"),c=!1)}),d=CoursePress.View.extend({template_id:"coursepress-cert-preview",className:"coursepress-popup-preview",events:{"click .cp-btn":"remove"},render:function(){CoursePress.View.prototype.render.apply(this),this.$el.appendTo("body")}}),CoursePress.View.extend({template_id:"coursepress-certificate-setting-tpl",el:a("#coursepress-setting-basic_certificate"),events:{'focus [name="cert_text_color"]':"showColorPicker","change [name]":"updateModel",'change [name="use_cp_default"]':"toggleCertificateSettings",'change [name="enabled"]':"toggleCertificateSettings",'click [name="preview_certificate"]':"previewCertificate"},initialize:function(a){this.model=a,this.on("view_rendered",this.setUpUI,this),this.render()},setUpUI:function(){var a=this;this.$("select").select2(),this.certBG=new CoursePress.AddImage(this.$("#coursepress-cert-bg")),this.color=this.$('[name="cert_text_color"]'),this.color.iris({palettes:!0,hide:!0,width:220,change:function(){a.model.cert_text_color=a.color.iris("color")}}),this.$("#content_certificate").val(this.model.content),this.$(".switch-tmce").trigger("click"),tinyMCE.get("content_certificate")&&(this.contentEditor=tinyMCE.get("content_certificate"),this.contentEditor.on("change",function(){a.updateCertificateContent()},this)),this.certBox=this.$(".box-cert-settings"),this.model.enabled&&!this.model.use_cp_default||this.certBox.hide()},updateCertificateContent:function(){this.model.content=this.contentEditor.getContent()},showColorPicker:function(){this.color&&(this.color.iris("show"),c=this.color)},updateModel:function(b){var c,d,e=a(b.currentTarget),f=e.attr("name"),g=e.val();e.is('[type="checkbox"],[type="radio"]')&&(g=!!e.is(":checked")&&g),f=f.split("."),c=f.shift(),d=this.model[c],f.length?(_.each(f,function(a){d[a]=g},this),this.model[c]=d):this.model[c]=g},getModel:function(){return this.model},toggleCertificateSettings:function(b){var c=this.$(".box-cert-settings"),d=a(b.currentTarget),e=d.is(":checked");"use_cp_default"===d.attr("name")?c[e?"slideUp":"slideDown"]():c[e?"slideDown":"slideUp"]()},previewCertificate:function(){var a=new CoursePress.Request(this.getModel());a.set("action","preview_certificate"),a.on("coursepress:success_preview_certificate",this.openPreview,this),a.save()},openPreview:function(a){a.pdf&&(this.preview=new d(a))}})})}(),function(){"use strict";CoursePress.Define("ShortcodesSettings",function(a){return CoursePress.View.extend({template_id:"coursepress-shortcodes-setting-tpl",el:a("#coursepress-setting-shortcodes"),events:{"click .cp-select-list.cp-type li":"typeSelect","click .cp-select-list.cp-sub-type li":"subTypeSelect"},typeSelect:function(b){var c=a(b.currentTarget),d=c.data("id");this.$(".cp-sub-type").addClass("inactive"),this.$(".cp-sub-type li").removeClass("active"),this.$("#"+d).removeClass("inactive"),this.$(".cp-shortcode-details").removeClass("active").addClass("inactive"),this.$("#"+d+" li").first().trigger("click"),c.siblings().removeClass("active"),c.addClass("active")},subTypeSelect:function(b){var c=a(b.currentTarget);this.setActiveItem(c),this.$(".cp-shortcode-details").removeClass("active").addClass("inactive"),this.$("#"+c.data("id")).removeClass("inactive").addClass("active")},setActiveItem:function(a){a.siblings().removeClass("active"),a.addClass("active")}})})}(),function(){"use strict";CoursePress.Define("ExtensionsSettings",function(a,b,c){var d,e;return d=CoursePress.View.extend({type:!1,initialize:function(a,b){_.extend(this,b),this.model[this.type]=_.isObject(a)?a:{},this.render()},render:function(){return CoursePress.View.prototype.render.apply(this),this.$el.appendTo("#extension-"+this.type),this},updateModel:function(b){var c,d,e,f;c=a(b.currentTarget),d=c.attr("name"),f=(e=c.attr("type"))&&_.contains(["checkbox","radio"],e)?!!c.is(":checked")&&c.val():c.val(),this.model[this.type][d]=f;var g=this.controller.setting.model.get(this.type);window.console.log(g),this.controller.setting.model.set(this.type,this.model[this.type])}}),e=new CoursePress.Request,CoursePress.View.extend({template_id:"coursepress-extensions-setting-tpl",el:a("#coursepress-setting-extensions"),extensions:{},setting:!1,initialize:function(a,b){window.console.log(a),this.model={extensions:a},this.setting=b,this.render()},render:function(){CoursePress.View.prototype.render.apply(this),_.each(this.model.extensions,function(a){this.showExtension(a)},this)},updateModel:function(a){var b=this.$(a.currentTarget),d=b.val(),e=b.is(":checked"),f=this.model.extensions;if(e&&("woocommerce"===d&&_.contains(f,"marketpress")||"marketpress"===d&&_.contains(f,"woocommerce")))return this.popup=new CoursePress.PopUp({type:"error",message:c._coursepress.messages.no_mp_woo}),b.prop("checked",!1),!1;this.model.extensions=_.without(this.model.extensions,d),e?(this.model.extensions.push(d),this.showExtension(d)):this.hideExtension(d)},showExtension:function(b){if(!this.extensions[b]){if(!a("#coursepress-"+b+"-tpl").length)return;this.extensions[b]=new d(this.setting.model.get(b),{template_id:"coursepress-"+b+"-tpl",type:b,controller:this})}},hideExtension:function(a){this.extensions[a]&&(this.extensions[a].remove(),delete this.extensions[a])},getModel:function(){var a=this.model.extensions;return _.contains(a,"marketpress")&&_.contains(a,"woocommerce")?(this.popup=new CoursePress.PopUp({type:"error",message:c._coursepress.messages.no_mp_woo}),!1):(_.contains(a,"marketpress")?(e.set("action","activate_marketpress"),e.off("coursepress:success_activate_marketpress"),e.on("coursepress:success_activate_marketpress",this.MPActivated,this),e.save()):_.contains(a,"woocommerce"),a)},MPActivated:function(){}})})}(),function(){"use strict";CoursePress.Define("ImportExportSettings",function(a,b,c){var d;return d=CoursePress.View.extend({events:{submit:"uploadFile",'change [name="import"]':"validateFile","change [name]":"updateModel"},initialize:function(){this.uploadModel=new CoursePress.Upload,this.model=new CoursePress.Request,this.render()},render:function(){this.errorContainer=this.$(".cp-alert-error")},uploadFile:function(){return this.validateFile()&&(this.uploadModel.set("type","import_file"),this.uploadModel.off("coursepress:success_import_file"),this.uploadModel.on("coursepress:success_import_file",this.uploadCourse,this),this.uploadModel.upload()),!1},uploadCourse:function(a){this.model.set("action","import_course"),this.model.set(a),this.model.off("coursepress:success_import_course"),this.model.on("coursepress:successs_import_course",this.maybeContinue,this),this.model.save()},maybeContinue:function(){},validateFile:function(){var a=this.$('[name="import"]'),b=a.val();return"json"!==b.substring(b.lastIndexOf(".")+1)?(this.errorContainer.html(c._coursepress.text.invalid_file_type).show(),this.$el.addClass("active"),!1):(this.errorContainer.hide(),this.$el.removeClass("active"),!0)}}),CoursePress.View.extend({template_id:"coursepress-import-export-setting-tpl",el:a("#coursepress-setting-import-export"),initialize:function(){this.on("view_rendered",this.setUpForms,this),this.render()},setUpForms:function(){this.importForm=d.extend({el:this.$("#form-import")}),this.importForm=new this.importForm}})})}(),function(){"use strict";CoursePress.Define("Settings",function(a,b,c){var d;return d=CoursePress.View.extend({el:a("#coursepress-settings"),settings:{},currentPage:"general",currentView:!1,events:{"click .cp-menu-item":"setSettingPage","click .save-coursepress-setting":"saveSetting","click .step-cancel":"goToGeneral","change [name]":"updateModel"},initialize:function(){this.once("coursepress:admin_setting_general",this.getGeneralSettingView,this),this.once("coursepress:admin_setting_slugs",this.getSlugsSettingView,this),this.once("coursepress:admin_setting_email",this.getEmailSettingView,this),this.once("coursepress:admin_setting_capabilities",this.getCapabilitiesView,this),this.once("coursepress:admin_setting_basic_certificate",this.getCertificateView,this),this.once("coursepress:admin_setting_shortcodes",this.getShortCodesView,this),this.once("coursepress:admin_setting_extensions",this.getExtensionsView,this),this.once("coursepress:admin_setting_import-export",this.getImportExportView,this),CoursePress.View.prototype.initialize.apply(this,arguments)},render:function(){this.settingPages=this.$(".cp-menu-item"),this.cancelButton=this.$(".step-cancel"),this.saveButton=this.$(".save-coursepress-setting"),this.on("coursepress:admin_setting",this.setCurrentPage,this),this.setPage(this.currentPage)},setCurrentPage:function(){this.currentMenu=this.$(".cp-menu-item.setting-"+this.currentPage),this.currentView=this.$("#coursepress-setting-"+this.currentPage),this.currentMenu.addClass("active"),this.currentMenu.siblings().removeClass("active"),this.currentView.addClass("tab-active"),this.currentView.siblings().removeClass("tab-active"),"general"===this.currentPage?this.cancelButton.attr("disabled","disabled"):this.cancelButton.removeAttr("disabled"),"import-export"===this.currentPage?(this.cancelButton.hide(),this.saveButton.hide()):(this.cancelButton.show(),this.saveButton.show())},setPage:function(a){this.currentPage=a,this.trigger("coursepress:admin_setting",a),this.trigger("coursepress:admin_setting_"+a)},setSettingPage:function(b){var c=a(b.currentTarget),d=c.data("setting");this.setPage(d)},getGeneralSettingView:function(){this.settings.general=new CoursePress.GeneralSettings(this.model.get("general"))},getSlugsSettingView:function(){this.settings.slugs=new CoursePress.SlugsSettings(this.model.get("slugs"))},getEmailSettingView:function(){this.settings.email=new CoursePress.EmailSettings(this.model.get("email"))},getCapabilitiesView:function(){this.settings.capabilities=new CoursePress.CapabilitiesSettings(this.model.get("capabilities"))},getCertificateView:function(){this.settings.basic_certificate=new CoursePress.CertificateSettings(this.model.get("basic_certificate"))},getShortCodesView:function(){this.settings.shortcodes=new CoursePress.ShortcodesSettings},getExtensionsView:function(){this.settings.extensions=new CoursePress.ExtensionsSettings(this.model.get("extensions"),this)},getImportExportView:function(){this.settings["import-export"]=new CoursePress.ImportExportSettings},saveSetting:function(a){var b=this.settings[this.currentPage],c=this.$(a.currentTarget),d=b.getModel();d&&(c.addClass("cp-progress"),this.model.set(this.currentPage,d),this.model.set("action","update_settings"),this.model.off("coursepress:success_update_settings"),this.model.on("coursepress:success_update_settings",this.after_update,this),this.model.off("coursepress:error_update_settings"),this.model.on("coursepress:error_update_settings",this.after_update,this),this.model.save())},goToGeneral:function(){this.$(".cp-menu-item.setting-general").trigger("click"),a(c).scrollTop(0)},after_update:function(){this.$(".save-coursepress-setting").removeClass("cp-progress")}}),d=new d(c._coursepress.settings)})}();