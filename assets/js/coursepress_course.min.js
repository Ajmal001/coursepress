/*! CoursePress - v3.0.0
 * https://premium.wpmudev.org/project/coursepress-pro/
 * Copyright (c) 2017; * Licensed GPLv2+ */
!function(){"use strict";CoursePress.Define("CourseModel",function(){return CoursePress.Request.extend({updateCourseData:function(){this.set("action","update_course"),this.off("coursepress:error_update_course"),this.on("coursepress:error_update_course",this.courseUpdateError,this),this.save()},courseUpdateError:function(){}})})}(),function(){"use strict";CoursePress.Define("SampleCourse",function(a,b,c){return CoursePress.View.extend({template_id:"coursepress-sample-course-tpl",className:"coursepress-wrap coursepress-modal",events:{"click .cp-close":"remove","change [name]":"updateModel","click .cp-btn-active":"getSampleCourse"},initialize:function(a,b){this.setupModel=b,this.model=new CoursePress.Request,this.on("view_rendered",this.setUI,this),this.model.set("action","import_sample_course"),this.model.on("coursepress:success_import_sample_course",this.setSelected,this),this.model.on("coursepress:success_import_course",this.setImportedCourse,this),this.render()},setUI:function(){var a;a=this.$('[type="radio"]').first(),a.prop("checked",!0).trigger("change")},render:function(){CoursePress.View.prototype.render.apply(this),this.$el.appendTo("body")},getSampleCourse:function(){this.model.save()},setSelected:function(a){a.import_id&&(a=_.extend({replace:!1,with_students:!1,with_comments:!1,action:"import_course"},a),this.model.set(a),this.model.save())},setImportedCourse:function(a){if(window.console.log(a),a.course){var b=c._coursepress.pagenow+"&cid="+a.course.ID;c.location=b}}})})}(),function(){"use strict";CoursePress.Define("CourseType",function(a,b,c){return CoursePress.View.extend({template_id:"coursepress-course-type-tpl",el:a(".coursepress-page #course-type"),courseEditor:!1,events:{'keyup [name="post_title"]':"updatePostName",'keyup [name="post_name"]':"updateSlug",'change [name="meta_course_type"]':"changeCourseType",'change [name="meta_payment_paid_course"]':"changeCoursePaid","change [name]":"updateModel","focus [name]":"removeErrorMarker","click .sample-course-btn":"selectSampleCourse"},initialize:function(a,b){this.model=a,this.courseEditor=b,b.on("coursepress:validate-course-type",this.validate,this),b.on("coursepress:before-next-step-course-type",this.updateCourseModel,this),this.on("view_rendered",this.setUI,this),this.render()},validate:function(){var a,b;a=!0,b=this.$('[name="post_title"]'),b.parent().removeClass("cp-error"),this.courseEditor.goToNext=!1,this.model.get("post_title")||(a=!1,b.parent().addClass("cp-error")),"manual"===this.model.course_type&&(this.model.course_start_date||this.model.course_end_date||this.model.enrollment_start_date||this.model.enrollment_end_date||(a=!1)),this.courseEditor.goToNext=a},updateCourseModel:function(){this.courseEditor.updateCourse()},setUI:function(){this.$(".datepicker").datepicker({dateFormat:"MM dd, yy"}),this.model.get("payment_paid_course")&&this.$('[name="meta_payment_paid_course"]').trigger("change")},updateModel:function(a){this.courseEditor.updateModel(a)},updatePostName:function(b){var c=a(b.currentTarget),d=this.$('[name="post_name"]'),e=c.val();e&&(e=e.toLowerCase().replace(/ /g,"-")),d.val(e),d.trigger("keyup")},updateSlug:function(b){var c=a(b.target);this.$(".cp-slug").html(c.val()),c.trigger("change")},changeCourseType:function(b){var c=a(b.currentTarget),d=c.val(),e=this.$("#type-"+d);c.parents("li").siblings().removeClass("active"),c.parents("li").addClass("active"),e.siblings(".cp-course-type").removeClass("active").addClass("inactive"),e.addClass("active").removeClass("inactive")},selectSampleCourse:function(){this.sample=new CoursePress.SampleCourse({},this)},changeCoursePaid:function(b){var d,e;d=this.$(b.currentTarget).is(":checked"),e=c._coursepress.settings,a(".cp-box-marketpress, .cp-box-woocommerce").addClass("hidden"),d&&(_.contains(e.extensions,"marketpress")&&e.marketpress&&e.marketpress.enabled&&a(".cp-box-marketpress").removeClass("hidden"),_.contains(e.extensions,"woocommerce")&&e.woocommerce&&e.woocommerce.enabled&&a(".cp-box-woocommerce").removeClass("hidden"))}})})}(),function(){"use strict";CoursePress.Define("CourseSettings",function(a,b,c){return CoursePress.View.extend({el:a("#course-settings"),template_id:"coursepress-course-settings-tpl",courseEditor:!1,events:{"click #cp-create-cat":"createCategory","keyup .cp-categories-selector .select2-search__field":"updateSearchValue","click #cp-instructor-selector":"instructorSelection","click #cp-facilitator-selector":"facilitatorSelection","click ul.cp-tagged-list-removable li":"removeUser","change [name]":"updateModel","focus [name]":"removeErrorMarker",'change [name="meta_enrollment_type"]':"toggleBoxes"},initialize:function(a,b){this.model=a,this.request=new CoursePress.Request,this.courseEditor=b,this.course_id=c._coursepress.course.ID,b.on("coursepress:validate-course-settings",this.validate,this),b.on("coursepress:before-next-step-course-settings",this.updateCourseModel,this),this.on("view_rendered",this.setUpUI,this),this.request.on("coursepress:success_create_course_category",this.updateCatSelection,this),this.request.on("coursepress:success_remove_from_course",this.removeUserTag,this),this.render()},validate:function(){var a,b,c;if(c=!0,a=this.$('[name="post_excerpt"]'),b=this.$('[name="post_content"]'),this.courseEditor.goToNext=!0,this.model.get("post_excerpt")||(a.parent().addClass("cp-error"),c=!1),this.model.get("post_content")||(b.parent().addClass("cp-error"),c=!1),!1===c)return this.courseEditor.goToNext=!1,!1},updateCourseModel:function(){this.courseEditor.updateCourse()},setUpUI:function(){var a,b;a=this,this.listing_image=new CoursePress.AddImage(this.$("#listing_image")),this.listing_video=new CoursePress.AddVideo(this.$("#listing_video")),this.$("#course-categories").select2({tags:!0}),b=this.$('[name="meta_enrollment_type"]'),b.select2(),b.on("change",function(b){a.updateModel(b),a.toggleBoxes(b)}),_.delay(function(){a.visualEditor({content:a.model.get("post_excerpt"),container:a.$(".cp-course-overview"),callback:function(b){a.model.set("post_excerpt",b)}})},100),_.delay(function(){a.visualEditor({content:a.model.get("post_content"),container:a.$(".cp-course-description"),callback:function(b){a.model.set("post_content",b)}})},500)},createCategory:function(){var a=this.$("#course-categories-search").val();""!==a&&(this.request.set({action:"create_course_category",name:a}),this.request.save())},updateCatSelection:function(a){var b=this.$("#course-categories").val();b=null===b?[]:b,b.push(a),this.$("#course-categories").val(b).trigger("change")},updateSearchValue:function(b){var c=a(b.currentTarget);this.$("#course-categories-search").val(c.val())},instructorSelection:function(){new CoursePress.CourseModal({course:this,template_id:"coursepress-course-instructor-selection-tpl",type:"instructor"})},facilitatorSelection:function(){new CoursePress.CourseModal({course:this,template_id:"coursepress-course-facilitator-selection-tpl",type:"facilitator"})},removeUser:function(b){var c=a(b.currentTarget),d=c.parent().data("user-type"),e=c.data("user-id");""!==e&&(this.request.set({action:"remove_from_course",type:d,course_id:this.course_id,user:e}),this.request.target=c,this.request.save())},removeUserTag:function(){void 0!==this.request.target&&this.request.target.remove()},updateModel:function(a){this.courseEditor.updateModel(a)},toggleBoxes:function(a){var b,c,d;b=this.$(a.currentTarget),c=b.val(),d=this.$(".cp-boxes"),d.slideUp(),"passcode"===c?this.$(".cp-passcode-box").slideDown():"prerequisite"===c&&this.$(".cp-requisite-box").slideDown()}})})}(),function(){"use strict";CoursePress.Define("CourseModal",function(a,b,c){return CoursePress.View.extend({template_id:!1,className:"coursepress-modal",events:{"click .cp-close":"remove","click .cp-send-invite":"sendInvite","click .cp-assign-user":"assignUser"},initialize:function(a){this.course=a.course,this.request=new CoursePress.Request,this.template_id=a.template_id,this.type=a.type,this.inv_resp=".cp-invitation-response-"+a.type,this.assgn_resp=".cp-assign-response-"+a.type,this.on("view_rendered",this.setUpUI,this),this.request.on("coursepress:success_send_email_invite",this.inviteSuccess,this),this.request.on("coursepress:success_assign_to_course",this.assignSuccess,this),this.request.on("coursepress:error_send_email_invite",this.inviteError,this),this.request.on("coursepress:error_assign_to_course",this.assignError,this),this.render()},setUpUI:function(){this.setupAjaxSelect2(this.$("#cp-course-instructor"),"instructor"),this.setupAjaxSelect2(this.$("#cp-course-facilitator"),"facilitator")},setupAjaxSelect2:function(b,d){var e=this.course.course_id;b.select2({minimumInputLength:3,width:"100%",ajax:{url:c._coursepress.ajaxurl,dataType:"json",delay:500,data:function(a){return{search:a.term,_wpnonce:c._coursepress._wpnonce,action:"coursepress_get_users",type:d,course_id:e}},processResults:function(b){return{results:a.map(b,function(a){return{id:a.ID,text:a.user_login}})}},cache:!0}})},render:function(){CoursePress.View.prototype.render.apply(this),this.$el.appendTo("body")},sendInvite:function(){var a=this.$("#cp-invite-email-"+this.type).val();""!==a&&(this.request.set({action:"send_email_invite",type:this.type,email:a,course_id:this.course.course_id}),this.request.save())},inviteSuccess:function(a){this.$("#cp-invite-email-"+this.type).val(""),this.showResponse(a,this.inv_resp)},inviteError:function(a){this.showResponse(a,this.inv_resp)},assignUser:function(){var a=this.$("#cp-course-"+this.type).val();""!==a&&(this.request.set({action:"assign_to_course",type:this.type,course_id:this.course.course_id,user:a}),this.request.save())},assignSuccess:function(a){void 0!==a.name&&void 0!==a.id&&this.course.$("ul#cp-list-"+this.type).append('<li data-user-id="'+a.id+'">'+a.name+"</li>"),this.course.$("#cp-no-"+this.type).length&&this.course.$("#cp-no-"+this.type).remove(),this.$("#cp-course-"+this.type).val(""),this.showResponse(a,this.assgn_resp)},assignError:function(a){this.showResponse(a,this.assgn_resp)},showResponse:function(a,b){var c=this.$(b);c.html(a.message).removeClass("inactive"),window.setTimeout(function(){c.html("").addClass("inactive")},2500)}})})}(),function(){"use strict";CoursePress.Define("CourseCompletion",function(a,b,c){var d,e;return a(b).on("click",function(b){var c=a(b.target);!d||c.is(".iris-input")&&c.is(".iris-picker")||(d.iris("hide"),d=!1)}),e=CoursePress.View.extend({template_id:"coursepress-cert-preview",className:"coursepress-popup-preview",events:{"click .cp-btn":"remove"},render:function(){CoursePress.View.prototype.render.apply(this),this.$el.appendTo("body")}}),CoursePress.View.extend({template_id:"coursepress-course-completion-tpl",el:a("#course-completion"),courseEditor:!1,current:"pre_completion",events:{'focus [name="meta_cert_text_color"]':"showColorPicker",'change [name="meta_basic_certificate"]':"toggleSetting","change [name]":"updateModel","click .cp-select-list li":"switchCompletionPage","focus [name]":"removeErrorMarker","click .cp-preview-cert":"previewCertificate"},initialize:function(a,b){this.model=a,this.courseEditor=b,b.on("coursepress:validate-course-completion",this.validate,this),b.on("coursepress:before-next-step-course-type",this.updateCourseModel,this),this.on("view_rendered",this.setUpUI,this),this.render()},toggleSetting:function(b){var c=a(b.currentTarget),d=c.is(":checked");this.$("#custom-certificate-setting")[d?"slideDown":"slideUp"]()},setUpUI:function(){var a;a=this,this.background=new CoursePress.AddImage(this.$('[name="meta_certificate_background"]')),this.$("select").select2(),this.the_title=this.$("#page-completion-title"),this.the_content=this.$("#page-completion-content"),this.color=this.$('[name="meta_cert_text_color"]'),this.color.iris({palettes:!0,hide:!0,width:220,change:function(){a.model.set("meta_cert_text_color",a.color.iris("color"))}}),this.$(".cp-select-list li").first().trigger("click")},showColorPicker:function(){!d&&this.color&&(this.color.iris("show"),d=this.color)},switchCompletionPage:function(a){var b,d,e,f,g,h;b=this.$(a.currentTarget),d=b.data("page"),e=this.$("#completion-title"),f=this.$("#completion-description"),b.siblings().removeClass("active"),b.addClass("active"),h=this,this.current=d,(g=c._coursepress.completion_pages[d])&&(e.html(g.title),f.html(g.description),this.the_title.val(this.model.get(d+"_title")),this.visualEditor({content:this.model.get(d+"_content"),container:this.$(".cp-completion-content"),callback:function(a){h.model.set(d+"_content",a)}}))},validate:function(){var a=!0;if(this.the_title.val()||(this.the_title.parent().addClass("cp-error"),a=!1),!a)return this.courseEditor.goToNext=!1,!1},updateCourseModel:function(){this.courseEditor.updateCourse()},updateModel:function(b){var c,d,e,f,g,h;c=a(b.currentTarget),d=c.attr("name"),f=(e=c.attr("type"))&&_.contains(["checkbox","radio"],e)?!!c.is(":checked")&&c.val():c.val(),d=d.split("."),g=d.shift(),h=this.model.get(g),d.length?(_.each(d,function(a){h[a]=f},this),this.model.set(g,h)):this.model.set(g,f)},previewCertificate:function(){var a=new CoursePress.Request(this.model.toJSON());a.set("action","preview_certificate"),a.on("coursepress:success_preview_certificate",this.openPreview,this),a.save()},openPreview:function(a){a.pdf&&(this.preview=new e(a))}})})}(),function(){"use strict";CoursePress.Define("Step_TEXT",function(){return CoursePress.View.extend({stepView:!1,initialize:function(a,b){this.stepView=b,this.render()},render:function(){var a=this;this.visualEditor({content:this.model.post_content,container:this.$el,callback:function(b){a.model.post_content=b}})}})})}(),function(){"use strict";CoursePress.Define("Step_IMAGE",function(){return CoursePress.View.extend({template_id:"coursepress-step-image",stepModel:!1,events:{'change [name="meta_show_media_caption"]':"toggleMediaCaption",'change [name="meta_caption_field"]':"toggleCustomCaption","change [name]":"updateModel"},initialize:function(a,b){this.stepModel=b,this.on("view_rendered",this.setUI,this),this.render()},setUI:function(){this.image=new CoursePress.AddImage(this.$(".cp-add-image-input"))},toggleMediaCaption:function(a){var b=this.$(a.currentTarget),c=b.is(":checked");this.$(".image-custom-caption")[c?"slideDown":"slideUp"]()},toggleCustomCaption:function(a){var b=this.$(a.currentTarget),c=b.is(":checked"),d=this.$('[name="meta_caption_custom_text"]');c&&"custom"===b.val()?d.removeAttr("disabled").focus():d.attr("disabled","disabled")},updateModel:function(a){this.stepModel.updateModel(a)}})})}(),function(){"use strict";CoursePress.Define("Step_VIDEO",function(){return CoursePress.View.extend({template_id:"coursepress-step-video",video_source:!1,stepView:!1,events:{'change [name="meta_allow_retries"]':"toggleGreyBox","change [name]":"updateModel"},initialize:function(a,b){this.stepView=b,this.on("view_rendered",this.setUI,this),this.render()},setUI:function(){this.video_source=new CoursePress.AddVideo(this.$(".cp-add-video"))},toggleGreyBox:function(a){this.stepView.toggleGreyBox(a)},updateModel:function(a){this.stepView.updateModel(a)}})})}(),function(){"use strict";CoursePress.Define("Step_AUDIO",function(){return CoursePress.View.extend({template_id:"coursepress-step-audio",events:{'change [name="meta_allow_retries"]':"toggleGreyBox","change [name]":"updateModel"},initialize:function(a,b){this.stepView=b,this.on("view_rendered",this.setUI,this),this.render()},setUI:function(){this.audio_source=new CoursePress.AddMedia(this.$(".cp-add-audio"))},toggleGreyBox:function(a){this.stepView.toggleGreyBox(a)},updateModel:function(a){this.stepView.updateModel(a)}})})}(),function(){"use strict";CoursePress.Define("Step_INPUT-UPLOAD",function(){return CoursePress.View.extend({template_id:"coursepress-step-file-upload",stepView:!1,events:{'change [name="meta_show_content"]':"toggleContent","change [name]":"updateModel"},initialize:function(a,b){this.stepView=b,this.on("view_rendered",this.setUI,this),this.render()},setUI:function(){var a=this;this.description=this.$(".cp-step-description"),this.visualEditor({container:this.description,content:this.model.post_content,callback:function(b){a.model.set("post_content",b)}})},toggleContent:function(a){var b=this.$(a.currentTarget),c=b.is(":checked");this.description[c?"slideDown":"slideUp"]()},updateModel:function(a){this.stepView.updateModel(a)}})})}(),function(){"use strict";CoursePress.Define("Step_INPUT-QUIZ",function(a,b,c){var d,e,f;return f=CoursePress.View.extend({template_id:"coursepress-question-answer",className:"cp-box cp-answer-box",question:!1,events:{"click .cp-btn-trash":"removeAnswer","change [name]":"updateModel"},initialize:function(a,b){this.model=a,this.question=b,this.render()},removeAnswer:function(){this.remove()},updateModel:function(){}}),e=CoursePress.Request.extend({defaults:{title:"Untitled",question:"",options:{answers:[c._coursepress.text.step.answer_a,c._coursepress.text.step.answer_b,c._coursepress.text.step.answer_c],checked:[]}}}),d=CoursePress.View.extend({template_id:"coursepress-question-tpl",className:"cp-question-box",events:{"click .cp-btn-active":"addAnswer","click .question-toggle-button":"toggleQuestion","change [name]":"updateModel"},quizView:!1,initialize:function(a,b){this.model=new e(a),this.quizView=b,this.on("view_rendered",this.setUI,this),this.render()},setUI:function(){var a,b;a=this.model.get("options"),this.model.get("type"),a.answers&&_.each(a.answers,function(c,d){var e;e=a.checked&&!!a.checked[d],b={type:this.model.get("type"),answer:c,index:d,checked:e,cid:this.model.cid},b=new f(b,this),b.$el.appendTo(this.$(".question-answers"))},this)},addAnswer:function(){var a,b;b={question:""},a=new f(b,this),a.$el.appendTo(this.$(".question-answers"))},toggleQuestion:function(){this.$el.is(".open")?this.$el.removeClass("open"):this.$el.addClass("open")},updateModel:function(){var b,c,d,e,f,g,h,i;c=this.$('[name="title"]').val(),this.model.set("title",c),d=this.$('[name="question"]').val(),this.model.set("question",d),e=this.model.get("options"),e||(e={}),f=this.$('[name="answers"]'),g=[],_.each(f,function(b){b=a(b),g.push(b.val())},this),h=this.$('[name="checked"]'),i=[],_.each(h,function(b){b=a(b),b.is(":checked")?i.push(1):i.push(!1)},this),e.answers=g,e.checked=i,this.model.set("options",e),b=this.cid,this.quizView.questionsModel[b]=this.model,this.quizView.updateQuestions()}}),CoursePress.View.extend({template_id:"coursepress-step-quiz",questions:{},questionsModel:{},events:{"change .cp-question-type":"addQuestion",'change [name="meta_show_content"]':"toggleContent"},initialize:function(a,b){this.stepView=b,this.on("view_rendered",this.setUI,this),this.render()},setUI:function(){var a;a=this,this.description=this.$(".cp-step-description"),this.visualEditor({container:this.description,content:this.model.post_content,callback:function(b){a.model.post_content=b}}),this.$("select").select2(),this.model.questions&&(_.each(this.model.questions,function(a){this._addQuestion(a)},this),this.$(".no-content-info").hide(),this.$(".cp-questions-container").sortable())},addQuestion:function(a){var b,c,d;b=this.$(a.currentTarget),(c=b.val())&&(d={type:c},this._addQuestion(d),this.$(".no-content-info").hide(),this.$(".cp-questions-container").sortable())},_addQuestion:function(a){var b,c,e;c=this.model.questions,c||(c=[]),a.index=this.questions.length,b=new d(a,this),b.$el.appendTo(this.$(".cp-questions-container")),e=b.cid,this.questions[e]=b,this.questionsModel[e]=b.model,this.model.questions=this.questionsModel},toggleContent:function(a){var b=this.$(a.currentTarget),c=b.is(":checked"),d=this.$(".cp-step-description");c?d.slideDown():d.slideUp()},updateModel:function(a){this.stepView.updateModel(a)},updateQuestions:function(){this.model.meta_questions=this.model.questions=this.questionsModel,this.stepView.set("questions",this.model.questions),this.stepView.set("meta_questions",this.model.meta_questions),this.stepView.trigger("coursepress:model_updated",this.stepView.model,this.stepView)}})})}(),function(){"use strict";CoursePress.Define("Step_ZIPPED",function(){return CoursePress.View.extend({template_id:"coursepress-step-zipped",stepView:!1,events:{'change [name="meta_show_content"]':"toggleContent","change [name]":"updateModel"},initialize:function(a,b){this.stepView=b,this.on("view_rendered",this.setUI,this),this.render()},setUI:function(){var a=this;this.description=this.$(".cp-step-description"),this.visualEditor({container:this.description,content:this.model.get("post_content"),callback:function(b){a.model.set("post_content",b)}}),this.source=new CoursePress.AddMedia(this.$(".cp-add-media"))},toggleContent:function(a){var b=this.$(a.currentTarget),c=b.is(":checked"),d=this.$(".cp-step-description");c?d.slideDown():d.slideUp()},updateModel:function(a){this.stepView.updateModel(a)}})})}(),function(){"use strict";CoursePress.Define("Step_INPUT-WRITTEN",function(){var a;return a=CoursePress.View.extend({template_id:"coursepress-written-tpl",className:"cp-question-box",events:{"click .question-toggle-button":"toggleQuestion"},toggleQuestion:function(){this.$el.is(".open")?this.$el.removeClass("open"):this.$el.addClass("open")}}),CoursePress["Step_INPUT-QUIZ"].extend({template_id:"coursepress-step-written",view:!1,events:{"click .add-question":"addQuestion",'change [name="meta_show_content"]':"toggleContent"},setUI:function(){var a,b=this;this.description=this.$(".cp-step-description"),this.visualEditor({container:this.description,content:this.model.get("post_content"),callback:function(a){b.model.set("post_content",a)}}),(a=this.model.get("questions"))&&(_.each(a,function(a){this._addQuestion(a)},this),this.$(".no-content-info").hide(),this.$(".cp-questions-container").sortable())},addQuestion:function(){var a,b,c;b=this.model.get("questions"),b||(b=[]),c={type:"written",title:"Untitled",question:"",meta_placeholder_text:"",meta_word_limit:0},a=this._addQuestion(c),b.push(a),this.$(".no-content-info").hide(),this.$(".cp-questions-container").sortable()},_addQuestion:function(b){var c;return c=new a(b,this),c.$el.appendTo(this.$(".cp-questions-container")),c},toggleContent:function(a){var b=this.$(a.currentTarget),c=b.is(":checked"),d=this.$(".cp-step-description");c?d.slideDown():d.slideUp()}})})}(),function(){"use strict";CoursePress.Define("Step_DISCUSSION",function(){return CoursePress.View.extend({template_id:"coursepress-step-discussion",events:{'change [name="meta_show_content"]':"toggleContent","chanage [name]":"updateModel"},initialize:function(a,b){this.stepView=b,this.on("view_rendered",this.setUI,this),this.render()},setUI:function(){var a=this;this.description=this.$(".cp-step-description"),this.visualEditor({container:this.description,content:this.model.post_content,callback:function(b){a.model.post_content=b}})},toggleContent:function(a){var b=this.$(a.currentTarget),c=b.is(":checked"),d=this.$(".cp-step-description");c?d.slideDown():d.slideUp()},updateModel:function(a){this.stepView.updateModel(a)}})})}(),function(){"use strict";CoursePress.Define("Step_DOWNLOAD",function(){return CoursePress.View.extend({template_id:"coursepress-step-download",stepView:!1,events:{'change [name="meta_show_content"]':"toggleContent","change [name]":"updateModel"},initialize:function(a,b){this.stepView=b,this.on("view_rendered",this.setUI,this),this.render()},setUI:function(){var a=this;this.description=this.$(".cp-step-description"),this.visualEditor({container:this.description,content:this.model.post_content,callback:function(b){a.model.set("post_content",b)}}),this.source=new CoursePress.AddMedia(this.$(".cp-add-media"))},toggleContent:function(a){var b=this.$(a.currentTarget),c=b.is(":checked"),d=this.$(".cp-step-description");c?d.slideDown():d.slideUp()},updateModel:function(a){this.stepView.updateModel(a)}})})}(),function(){"use strict";CoursePress.Define("Unit_Steps",function(a){return CoursePress.View.extend({template_id:"coursepress-unit-steps-tpl",unitModel:!1,steps:{},menu_order:0,events:{"click .unit-step":"addNewStep"},initialize:function(a,b){this.steps={},this.unitModel=b,this.on("view_rendered",this.setUI,this),this.render()},setUI:function(){var b,c,d;this.stepContainer=this.$(".unit-steps"),(b=this.model.get("steps"))&&(_.each(b,function(a){c=this.setStep(a),c.toggleContents()},this),_.delay(function(){d=a(".unit-steps"),d.sortable({axis:"y",step:function(){c.reOrderSequence()}})},200))},toggleStep:function(a){a.toggleContents()},addNewStep:function(a){var b,c,d,e;d=this.steps.length+1,b=this.$(a.currentTarget),c=b.data("step"),e={module_type:c,menu_order:d},this.setStep(e)},setStep:function(a){var b,c;return this.menu_order+=1,a.menu_order=this.menu_order,b=new CoursePress.Step({model:a},this),b.$el.appendTo(this.stepContainer),c=b.model.cid,this.steps[c]=b.model,this.updateSteps(),b.on("coursepress:model_updated",this.updateStepsCollection,this),b},updateStepsCollection:function(a){var b;b=a.cid,this.steps[b]=a,this.updateSteps()},updateSteps:function(){this.unitModel.model.set("steps",this.steps)}})})}(),function(){"use strict";CoursePress.Define("Step",function(a,b,c){var d,e;return d={post_title:c._coursepress.text.untitled,post_content:"",show_title:!0,meta_show_title:!0,mandatory:!1,meta_mandatory:!1,assessable:!1,meta_assessable:!1,show_content:!1,meta_show_content:!1,allow_retries:!1,meta_allow_retries:!1,retry_attempts:0,meta_retry_attempts:0,minimum_grade:100,meta_minimum_grade:100},e={text:_.extend({module_type:"text",meta_module_type:"text"},d),image:_.extend({},d,{module_type:"image",meta_module_type:"image",image_url:"",meta_image_url:"",caption_field:"media",meta_caption_field:"media",caption_custom_text:"",meta_caption_custom_text:"",image_url_thumbnail_id:0,meta_image_url_thumbnail_id:0,show_media_cation:!1,meta_show_media_caption:!1}),"input-upload":_.extend({module_type:"input-upload",meta_module_type:"input-upload",allowed_file_types:["image","pdf","zip"],meta_allowed_file_types:["image","pdf","zip"]},d),discussion:_.extend({module_type:"discussion",meta_module_type:"discussion"},d),video:_.extend({module_type:"video",meta_module_type:"video",video_url:"",meta_video_url:"",show_media_caption:!1,meta_show_media_caption:!1,video_player_width:0,meta_video_player_with:0,video_player_height:0,meta_video_player_height:0,video_autoplay:!1,meta_video_autoplay:!1,video_loop:!1,meta_video_loop:!1,video_hide_controls:!1,meta_video_hide_controls:!1,hide_related_media:1,meta_hide_related_media:1},d),audio:_.extend({module_type:"audio",meta_module_type:"audio",audio_url:"",meta_audio_url:"",audio_url_thumbnail_id:0,meta_audio_url_thumbnail_id:0,loop:!1,meta_loop:!1,autoplay:!1,meta_autoplay:!1},d),download:_.extend({module_type:"download",meta_module_type:"download",file_url:"",meta_file_url:"",link_text:"",meta_link_text:""},d),zipped:_.extend({module_type:"zipped",meta_module_type:"zipped",zip_url:"",meta_zip_url:"",primary_file:"",meta_primary_file:"",link_text:"",meta_link_text:""},d),"input-quiz":_.extend({module_type:"input-quiz",meta_module_type:"input-quiz",questions:[]},d),"input-written":_.extend({questions:[]},d)},CoursePress.Request.extend({}),CoursePress.View.extend({template_id:"coursepress-step-tpl",type:"text",className:"unit-step-module open",stepController:!1,events:{"click .step-toggle-button":"toggleContents","click .step-config button":"toggleDropdown","click .menu-item-delete":"removeStep","click .menu-item-duplicate":"duplicateStep","focus [name]":"removeErrorMarker","change [name]":"updateModel"},initialize:function(a,b){this.model=_.extend({},e[this.model.module_type],this.model),this.type=this.model.module_type,this.model.cid||(this.model.cid=this.cid),this.stepController=b,this.on("view_rendered",this.setStep,this),this.render()},setStep:function(){var b,c,d,e;if(c=this,b="Step_"+this.type.toUpperCase(),CoursePress[b])return b=new CoursePress[b]({model:this.model},this),b.$el.appendTo(this.$(".cp-step-content")),_.delay(function(){c.unitSteps=a(".unit-steps"),c.unitSteps.sortable({axis:"y",stop:function(){c.reOrderSequence()}})},100),e=this.$(".menu-item-move"),d=this.stepController.unitModel.editCourseView.model.get("meta_with_modules"),d?e.show():e.hide(),CoursePress.Events.trigger("coursepress:step_rendered",this),b},toggleContents:function(){this.$el.is(".open")?this.$el.removeClass("open"):this.$el.addClass("open")},reOrderSequence:function(){this.trigger("coursepress:step_reordered",this.model)},toggleDropdown:function(a){var b=this.$(a.currentTarget),c=b.parent();c.is(".open")?c.removeClass("open"):c.addClass("open")},removeStep:function(){this.model.set("deleted",!0),this.trigger("coursepress:model_updated",this.model,this),this.remove()},duplicateStep:function(){new CoursePress.Step(this.model.toJSON(),this.stepController).$el.appendTo(a(".unit-steps")),this.$(".step-config").removeClass("open")},toggleGreyBox:function(a){var b,c,d;b=this.$(a.currentTarget),d=b.is(":checked"),c=b.parents("div").first().next(".cp-box-grey"),c.length&&c[d?"slideDown":"slideUp"]()}})})}(),function(){"use strict";CoursePress.Define("UnitHelp",function(a,b,c){return CoursePress.View.extend({template_id:"coursepress-unit-help-1-tpl",className:"coursepress-modal unit-help",current:1,events:{"click .cp-close":"goToNext","click .cp-btn-got-it-1":"goToNext","click .cp-btn-got-it-2":"hideHelpTab"},initialize:function(){this.render()},render:function(){var b=this;this.$el.html(""),CoursePress.View.prototype.render.apply(this),this.$el.appendTo("body"),this.body=this.$(".coursepress-popup-body"),this.menuContainer=a(".step-course-units"),a(c).on("resize",function(){b.fitToScreen()})},goToNext:function(){if(this.current>=6)return this.remove(),!1;this.$el.removeClass("unit-help"+this.current),this.current+=1,this.template_id="coursepress-unit-help-"+this.current+"-tpl",this.render(),this.$el.addClass("unit-help"+this.current),this.fitToScreen()},hideHelpTab:function(){CoursePress.Cookie("course_unit_helptab").set(1,31536e3),this.goToNext()},fitToScreen:function(){var a,b;3===this.current?(a=this.menuContainer.offset().left,b=this.menuContainer.offset().top,this.body.css({"margin-left":a+260,"margin-top":b})):this.body.css("")}})})}(),function(){"use strict";CoursePress.Define("UnitModules",function(a,b,c){var d,e;return d=CoursePress.View.extend({template_id:"coursepress-unit-module-list-tpl",initialize:function(a){this.model={modules:a},this.render()}}),e=CoursePress.View.extend({template_id:"coursepress-unit-module-steps-tpl",unitModel:!1,stepsView:!1,moduleView:!1,steps:{},stepsModel:{},menu_order:0,views:{},events:{"click .unit-step":"addNewStep","keyup .module-title":"updateModuleTitle",'change [name="show_description"]':"toggleDescription"},initialize:function(a,b){this.steps={},this.stepsModel={},this.model=a,this.unitModel=b.unitModel,this.moduleView=b,this.on("view_rendered",this.setUI,this),this.render()},setUI:function(){var a;this.stepContainer=this.$(".unit-steps"),a=this,this.visualEditor({content:this.model.description,container:this.$(".cp-module-description"),callback:function(b){a.model.description=b}}),this.model.steps&&_.each(this.model.steps,function(a){a=this.setStep(a),a.toggleContents()},this)},addNewStep:function(a){var b,c,d;b=this.$(a.currentTarget),c=b.data("step"),d={module_type:c,meta_module_type:c},this.setStep(d)},setStep:function(a){var b,c;return this.menu_order+=1,a.menu_order=this.menu_order,b=new CoursePress.Step({model:a},this),b.$el.appendTo(this.stepContainer),c=a.cid?a.cid:b.model.cid,this.steps[c]=b,this.stepsModel[c]=b.model,this.updateModuleSteps(b.model),b},updateModuleTitle:function(a){var b,c;b=this.$(a.currentTarget),c=b.val(),this.trigger("coursepress:update_module_title",c,this),this.model.title=c},updateModuleSteps:function(a){var b;b=a.cid,a.meta_module_page=a.module_page=this.model.id,this.steps[b].model=a,this.stepsModel[b]=a,this.model.steps=this.stepsModel,this.moduleView.modules[this.moduleView.current]=this.model},reorderSteps:function(){var b,c,d,e;b=this.stepContainer.find('[name="menu_order"]'),d={},e={},c=0,_.each(b,function(b){b=a(b),c+=1,b.val(c).trigger("change");var f=b.data("cid");d[f]=this.steps[f],e[f]=this.stepsModel[f]},this),this.stepsModel=e,this.model.steps=e,this.moduleView.modules[this.moduleView.current].steps=this.steps},setStepIcons:function(){var a={};this.$(".step-icon-container").empty(),_.each(this.steps,function(b){var c=b.module_type;a[c]||(a[c]=c)})},toggleDescription:function(a){var b,c,d;b=this.$(a.currentTarget),c=b.is(":checked"),d=this.$(".cp-module-description"),d[c?"slideDown":"slideUp"](),this.model.show_description=!!c}}),CoursePress.View.extend({template_id:"coursepress-unit-modules-tpl",current:1,modules:!1,moduleView:!1,active:!1,events:{"click .module-item":"setActiveModule","click .add-module":"addModule","change [name]":"updateModel","click .cp-delete-module":"deleteModule"},initialize:function(a,b){this.modules=this.model.get("modules"),this.unitModel=b,this.on("view_rendered",this.setUI,this),this.render()},setUI:function(){this.moduleListContainer=this.$("#unit-module-list"),this.stepsContainer=this.$("#cp-module-steps"),this.setModuleList(),this.$("[data-order]").first().trigger("click")},addModule:function(){var a,b,d;d=_.toArray(this.modules),b=d.length,a={id:b,title:c._coursepress.text.untitled,show_description:!0,description:"",steps:{}},this.modules[b]=a,this.model.set("modules",this.modules),this.current=b,this._setActiveModule(a),this.setModuleList(),this.$("[data-order]").last().trigger("click")},setModuleList:function(){var a=this;this.moduleListContainer.html(""),this.moduleList=new d(this.modules),this.moduleList.$el.appendTo(this.moduleListContainer),this.moduleListContainer.find(".cp-select-list").sortable({stop:function(){a.reOrderModules()}})},setActiveModule:function(a){var b,c,d;this.active=b=this.$(a.currentTarget),c=b.data("order"),this.current=parseInt(c),b.siblings().removeClass("active"),b.addClass("active"),d=this.modules[this.current],this._setActiveModule(d)},_setActiveModule:function(a){this.moduleView&&this.moduleView.remove(),a=_.extend({show_description:!0,description:""},a),this.moduleView=new e(a,this),this.moduleView.$el.appendTo(this.stepsContainer),this.moduleView.on("coursepress:update_module_title",this.updateActiveTitle,this)},updateActiveTitle:function(a){this.active.find("span").html(a),this.updateModuleModel()},updateModuleModel:function(){this.moduleView&&(this.modules[this.current]=this.moduleView.model,this.unitModel.model.set("modules",this.modules))},updateModel:function(a){a.stopImmediatePropagation()},reOrderModules:function(){var b,c;b=0,c=[],_.each(this.moduleListContainer.find(".cp-select-list li"),function(d){var e,f;d=a(d),e=d.data("order"),b+=1,f=this.modules[e],f.steps&&_.each(f.steps,function(a,c){a.meta_module_page=a.module_page=b,f.steps[c]=a},this),c[b]=f,d.attr("data-order",b),d.data("order",b)},this),this.modules=c,this.unitModel.model.set("modules",this.modules)},deleteModule:function(){this.moduleView&&(this.modules[this.current].deleted=!0,this.moduleView.remove(),this.setModuleList(),this.reOrderModules(),this.$("[data-order]").last().trigger("click"))}})})}(),function(){"use strict";CoursePress.Define("UnitDetails",function(a,b,c){return CoursePress.View.extend({template_id:"coursepress-unit-details",controller:!1,with_modules:!1,events:{'change [name="meta_use_feature_image"]':"toggleFeatureImage",'change [name="meta_use_description"]':"toggleDescription",'change [name="meta_unit_availability"]':"toggleAvailability","keyup .unit-title-input":"updateUnitTitle","change [name]":"updateModel","focus [name]":"removeErrorMarker"},initialize:function(a,b){this.controller=b,this.editCourseView=b.editCourseView,this.with_modules=this.editCourseView.model.get("meta_with_modules"),this.model.get("post_status")||this.model.set("post_status","pending"),this.model.set("with_modules",this.with_modules),this.on("coursepress:model_updated",this.updateUnitCollection,this),this.on("view_rendered",this.setUpUI,this),this.render()},validateUnit:function(){var a,b,d,e,f,g,h,i={};return a=!0,b=this.model.get("post_title"),d=this.model.get("meta_use_feature_image"),b&&"Untitled"!==b||(this.$('[name="post_title"]').parent().addClass("cp-error"),a=!1),d&&!this.model.get("meta_unit_feature_image")&&(this.$('[name="meta_unit_feature_image"]').parent().addClass("cp-error"),a=!1),this.with_modules?(e=this.model.get("modules"))&&_.each(e,function(a,b){a&&b>0&&(a.title&&"Untitled"!==a.title||(i.noname_module=c._coursepress.text.noname_module),(h=_.keys(a.steps))<=0&&(i.no_steps=c._coursepress.text.nosteps))},this):(g=this.model.get("steps"),(h=_.keys(g))<=0&&(i.no_steps=c._coursepress.text.nosteps)),f=_.keys(i),f.length>0&&(a=!1,i=_.values(i),new CoursePress.PopUp({type:"warning",message:i.join("")})),a},setUpUI:function(){var a;a=this,this.feature_image=new CoursePress.AddImage(this.$("#unit-feature-image")),this.$("select").select2(),this.visualEditor({content:this.model.get("post_content"),container:this.$(".cp-unit-description"),callback:function(b){a.model.set("post_content",b)}}),this.container=this.$("#unit-steps-container"),this.with_modules?(this.modules=new CoursePress.UnitModules({model:this.model},this),this.modules.$el.appendTo(this.container)):(this.steps=new CoursePress.Unit_Steps({model:this.model},this),this.steps.$el.appendTo(this.container))},toggleFeatureImage:function(a){var b=this.$(a.currentTarget),c=b.is(":checked");this.$(".cp-unit-feature-image")[c?"slideDown":"slideUp"]()},toggleDescription:function(a){var b=this.$(a.currentTarget),c=b.is(":checked");this.$(".cp-unit-description")[c?"slideDown":"slideUp"]()},toggleAvailability:function(a){var b=this.$(a.currentTarget),c=b.val();this.$(".cp-on_date, .cp-after_delay").slideUp(),"instant"!==c&&this.$(".cp-"+c).slideDown()},updateUnitTitle:function(a){var b=this.$(a.currentTarget),c=b.val();CoursePress.Events.trigger("coursepress:change_unit_title",c,this.model.cid)},updateUnitCollection:function(){var a;a=this.model.cid,this.editCourse.unitList.unitModels[a]=this.model,this.editCourse.unitList.updateUnitCollection()}})})}(),function(){"use strict";CoursePress.Define("UnitList",function(){var a,b,c;return b={ID:0,post_title:"Untitled",post_content:"",post_status:"pending",modules:{1:{id:1,title:"Untitled",steps:{},slug:""}},meta_use_feature_image:!1,meta_unit_feature_image:"",meta_use_description:!1,meta_unit_availability:"instant",meta_unit_availability_date:"",meta_force_current_unit_completion:!1,meta_force_current_unit_successful_completion:!1,count:0,steps:!1},a=CoursePress.View.extend({template_id:"coursepress-unit-item-tpl",className:"unit-item",tagName:"li",unitview:!1,listView:!1,unitDetails:!1,events:{click:"_setUnitDetails"},initialize:function(a,b){this.listView=b,this.editCourseView=b.editCourseView,this.render()},setUnitDetails:function(){this.editCourseView.unitsview.remove(),this.unitDetails=this.editCourseView.unitsview=new CoursePress.UnitDetails({model:this.model},this.listView),this.editCourseView.unitsview.$el.appendTo(this.editCourseView.unitsContainer),this.editCourseView.unitsview=this.unitDetails,this.$el.addClass("active"),this.$el.siblings().removeClass("active")},_setUnitDetails:function(a){this.$el.addClass("active"),this.$el.siblings().removeClass("active"),this.listView.setUnitDetails(this.model.cid),a.stopImmediatePropagation()}}),c=new CoursePress.Request,CoursePress.View.extend({template_id:"coursepress-unit-list-tpl",className:"unit-list-menu",units:{},unitModels:{},with_modules:!0,events:{"click .new-unit":"newUnit","click .unit-item":"setUnitDetails"},initialize:function(a,b){this.editCourseView=b,this.with_modules=b.model.get("meta_with_modules"),CoursePress.Events.on("coursepress:change_unit_title",this.updateTitle,this),this.on("view_rendered",this.setUI,this),this.render()},setUI:function(){this.$el.appendTo(this.editCourseView.current),this.listContainer=this.$(".units-list")},addUnit:function(b){var c,d,e;if(b.get("deleted"))return!1;e=this.with_modules?b.get("modules"):b.get("steps"),e=_.keys(e),d=b.cid,b.set("count",e.length),b.set("cid",d),c=new a({model:b},this),c.$el.appendTo(this.listContainer),this.units[d]=c,this.unitModels[d]=b},updateTitle:function(a,b){var c;this.units[b]&&(c=this.units[b],c.$(".unit-title").html(a))},newUnit:function(a){var c,d,e;c=new Backbone.Model(b),d=this.editCourseView.unitCollection.add(c.toJSON()),e=d.cid,this.units[e].$el.trigger("click"),a.stopImmediatePropagation()},getUnitModel:function(a){return this.unitModels[a]},updateUnits:function(){var a;a={},_.each(this.unitModels,function(b,c){b.get?a[c]=b.toJSON():a[c]=b},this),this.editCourseView.senderButton&&this.editCourseView.senderButton.addClass("cp-progress"),c.set("action","update_units"),c.set("course_id",this.editCourseView.model.get("ID")),c.set("units",a),c.off("coursepress:success_update_units"),c.on("coursepress:success_update_units",this.updateUnitModels,this),c.on("coursepress:error_update_units",this.updateError,this),c.save()},updateUnitModels:function(a){a.units&&(this.unitModels=_.extend(this.unitModels,a.units)),this.editCourseView.after_update()},updateCollection:function(){this.editCourseView.unitCollection.add(this.unitModels)},updateError:function(){window.alert("error"),this.editCourseView.after_update()},deleteUnit:function(a){var b,c;b=this.units[a],c=this.unitModels[a],c.set("deleted",!0),this.editCourseView.unitCollection.set(c),b.remove()},setUnitDetails:function(a){var b;b=this.getUnitModel(a),this.editCourseView.unitsview&&this.editCourseView.unitsview.remove(),this.editCourseView.unitsview=new CoursePress.UnitDetails({model:b},this),this.editCourseView.unitsview.$el.appendTo(this.editCourseView.unitsContainer)}})})}(),function(){"use strict";CoursePress.Define("UnitCollection",function(a,b,c){return Backbone.Collection.extend({url:c._coursepress.ajaxurl+"?action=coursepress_get_course_units&_wpnonce="+c._coursepress._wpnonce,unitsLoaded:!1,initialize:function(a){this.url+="&course_id="+a,this.on("error",this.serverError,this),this.fetch()},parse:function(a){return this.unitsLoaded=!0,this.trigger("coursepress:unit_collection_loaded",a.data),a.data},serverError:function(){window.alert("error")}})})}(),function(){"use strict";CoursePress.Define("UnitsWithModuleList",function(){var a;return a=CoursePress.View.extend({template_id:"coursepress-unit-tpl",className:"unit-view",unitsView:!1,steps:{},with_modules:!1,events:{"click .cp-unit-heading label":"toggleListing","click .edit-unit":"editUnit","click [data-module]":"editModule","click .delete-unit":"deleteUnit"},initialize:function(a,b){var c;this.model=a,c=b.editCourse.model.get("meta_with_modules"),c&&a.get("modules")||a.set("modules",!1),!c&&a.get("steps")||a.set("steps",!1),this.unitsView=b,this.render()},toggleListing:function(a){var b=this.$(a.currentTarget),c=b.parent().next(".cp-unit-content");c.is(":visible")?(c.slideUp(),b.addClass("close")):(c.slideDown(),b.removeClass("close"))},getUnit:function(a){return this.unitsView.editCourse.unitList.units[a]},editUnit:function(a){var b,c;b=this.$(a.currentTarget),c=b.data("unit"),this._editUnit(c)},_editUnit:function(a){var b;return b=this.getUnit(a),b&&b.setUnitDetails(),b},editModule:function(a){var b,c,d,e;b=this.$(a.currentTarget),c=b.data("module"),d=b.data("unit"),e=this._editUnit(d),e.unitview&&e.unitview.modules&&e.unitview.modules.$('.module-item[data-order="'+c+'"]').trigger("click")},deleteUnit:function(a){var b,c;b=this.$(a.currentTarget),c=b.data("unit"),this.unitsView.editCourse.unitList.deleteUnit(c),this.remove()}}),CoursePress.View.extend({template_id:"coursepress-units-tpl",className:"unit-view",editCourse:!1,unitItems:{},initialize:function(a,b){this.with_modules=b.model.get("meta_with_modules"),this.model=a,this.editCourse=b,this.editCourse.unitCollection.on("add",this.setUnitItem,this),this.editCourse.on("coursepress:validate-course-units",this.validateUnits,this),this.editCourse.unitCollection.on("coursepress:unit_collection_loaded",this.maybeSetUnit,this),this.on("view_rendered",this.setUI,this),this.render()},validateUnits:function(a){var b,c;this.editCourse.unitList.units,b=0,c={},b?c.length&&new CoursePress.PopUp({type:"warning",message:c.join("<br/>")}):this.editCourse.unitList.updateUnits(),a.stopImmediatePropagation()},maybeSetUnit:function(a){a&&a.length||this.editCourse.unitList.$(".new-unit").trigger("click")},setUI:function(){this.unitsContainer=this.$("#units-container"),this.editCourse.unitCollection&&this.editCourse.unitCollection.unitsLoaded&&_.each(this.editCourse.unitCollection.models,function(a){this.editCourse.unitList.addUnit(a),this.setUnitItem(a)},this)},setUnitItem:function(b){var c,d;b.get("deleted")||(c=b.cid,d=new a(b,this),d.$el.appendTo(this.unitsContainer),this.unitItems[c]=d)}})})}(),function(){"use strict";CoursePress.Define("UnitSteps",function(){return CoursePress.UnitsWithModuleList.extend({template_id:"coursepress-unit-list-steps-tpl",with_modules:!1})})}(),function(){"use strict";CoursePress.Define("Course_Students",function(a,b,c){var d,e,f;return new CoursePress.Request,e=CoursePress.View.extend({template_id:"coursepress-invited-student",tagName:"tr"}),d=CoursePress.View.extend({view:!1,events:{"click .send-invite":"sendInvitation","change [name]":"updateModel","focus [name]":"removeErrorMarker"},initialize:function(a,b){this.view=b,this.model=new CoursePress.Request},sendInvitation:function(){var a,b,c,d;d=0,a=this.$('[name="first_name"]'),b=this.$('[name="last_name"]'),c=this.$('[name="email"]'),this.model.get("first_name")||(a.parent().addClass("cp-error"),d++),this.model.get("last_name")||(b.parent().addClass("cp-error"),d++),this.model.get("email")||(c.parent().addClass("cp-error"),d++),d||(this.$(".send-invite").addClass("active"),this.model.set("action","send_student_invite"),this.model.set("course_id",this.course_id),this.model.off("coursepress:success_send_student_invite"),this.model.on("coursepress:success_send_student_invite",this.invitationSent,this),this.model.save())},invitationSent:function(a){var b;b=this.view.addInvitee(a),b.$el.addClass("invitee-active"),_.delay(function(){b.$el.removeClass("invitee-active")},1500),this.$(".send-invite").removeClass("active"),this.$('[name="first_name"],[name="last_name"],[name="email"]').val("")}}),CoursePress.View.extend({template_id:"coursepress-students-tpl",courseView:!1,el:a("#course-students"),events:{"click .cp-btn-withdraw-student":"withdrawStudent","click #add-student-button":"addStudent"},initialize:function(a,b){this.model=a,this.courseView=b,this.on("view_rendered",this.setUI,this),b.on("coursepress:step-before-change",this.removeClass,this),b.on("coursepress:step-changed",this.addClass,this),this.render()},removeClass:function(){a(".course-content").removeClass("coursepress-page-transparent")},addClass:function(b){"course-students"===b&&a(".course-content").addClass("coursepress-page-transparent")},setUI:function(){a(".course-content").addClass("coursepress-page-transparent"),d=d.extend({el:a("#student-invites"),course_id:this.model.get("ID")}),this.invite=new d({},this),c._coursepress.invited_students&&_.each(c._coursepress.invited_students,function(a){this.addInvitee(a)},this),this.setupAjaxSelect2()},addInvitee:function(a){var b,c;return c=this.$("#invited-list"),b=new e(a),b.$el.prependTo(c),c.find(".no-invites").hide(),b},withdrawStudent:function(b){var c=a(b.currentTarget);if(window.confirm(_coursepress.text.confirm.student.withdraw)){var d=new CoursePress.Request;d.set("action","withdraw_student"),d.set("course_id",this.model.get("ID")),d.set("student_id",c.data("id")),d.on("coursepress:success_withdraw_student",this.withdrawStudentSuccess,this),d.save()}return!1},withdrawStudentSuccess:function(b){a("#student-"+b.student_id).detach(),2>a("#coursepress-table-students tr").length&&(a("#coursepress-table-students tr.noitems").show(),a(".tablenav.cp-admin-pagination").hide())},setupAjaxSelect2:function(){a("#add-student-select").select2({minimumInputLength:1,placeholder:c._coursepress.text.student_search,ajax:{url:c._coursepress.ajaxurl,dataType:"json",delay:500,data:function(a){return{search:a.term,_wpnonce:c._coursepress._wpnonce,action:"coursepress_search_students",course_id:c._coursepress.course.ID}},processResults:function(b){return{results:a.map(b.data,function(a){return{id:a.ID,text:a.display_name}})}},cache:!0}})},addStudent:function(){var b=new CoursePress.Request;b.set("action","add_student_to_course"),b.set("course_id",c._coursepress.course.ID),b.set("student_id",a("#add-student-select").val()),b.set("_wpnonce",c._coursepress._wpnonce),b.on("coursepress:success_add_student_to_course",this.addStudentSuccess,this),b.save()},addStudentSuccess:function(b){var c,d;d=this.$("#coursepress-table-students"),f=CoursePress.View.extend({template_id:"coursepress-course-add-student",tagName:"tr",id:"student-"+b.ID}),c=new f(b),c.$el.prependTo(d),a("#coursepress-table-students tr.noitems").hide()}})})}(),function(){"use strict";CoursePress.Define("CourseSetUp",function(a,b,c){var d;d=CoursePress.View.extend({steps:[],currentStep:!1,goNextStep:!1,el:a("#course-edit-template"),unitsview:!1,savemode:"continue",senderButton:!1,events:{"click .step .menu-label":"toggleContent","click .step-back":"getPreviousStep","click .step-next":"getNextStep","click .step-save":"saveCourse","click .step-cancel":"returnToMainPage","click .step-icon-bars":"toggleStepList","change [name]":"updateModel"},initialize:function(a){a=this.filter_model(a),this.model=new CoursePress.Request(a),this.once("coursepress:load-step-course-type",this.courseTypeView,this),this.once("coursepress:load-step-course-settings",this.courseSettingsView,this),this.once("coursepress:load-step-course-completion",this.courseCompletionView,this),this.on("coursepress:load-step-course-units",this.courseUnitsView,this),this.once("coursepress:load-step-course-students",this.courseStudentsView,this),this.model.on("coursepress:success_update_course",this.courseUpdated,this),this.model.on("coursepress:error_update_course",this.courseUpdateError,this),this.render()},filter_model:function(a){var b=["course_start_date","course_end_date","enrollment_start_date","enrollment_end_date"];return _.each(b,function(b){a[b]||(a[b]="")}),a.class_size||(a.class_size=0),a},render:function(){var a;return _.each(this.$(".cp-menu-item"),this.getSteps,this),this.prevButton=this.$(".step-back"),this.stepListContainer=this.$(".cp-menu-items .course-menu"),this.firstStep=_.first(this.steps),this.lastStep=_.last(this.steps),this.on("coursepress:step-changed",this.stepChanged,this),_.isEmpty(this.model.get("post_title"))||(a=CoursePress.Cookie("course_setup_step_"+this.model.get("ID")).get()),a||(a=_.first(this.steps)),this.setCurrentStep(a),this},courseTypeView:function(){return new CoursePress.CourseType(this.model,this)},courseSettingsView:function(){return new CoursePress.CourseSettings(this.model,this)},courseCompletionView:function(){return new CoursePress.CourseCompletion(this.model,this)},courseUnitsView:function(){var b,c;b=this.model.get("meta_with_modules"),this.unitsContainer=a("#course-units"),c=this.model.get("ID"),this.unitsview&&(this.unitsview.remove(),this.unitList.remove()),this.unitCollection||(this.unitCollection=new CoursePress.UnitCollection(c)),this.unitList=new CoursePress.UnitList({},this),this.unitCollection.on("add",this.unitList.addUnit,this.unitList),this.unitsview=b?new CoursePress.UnitsWithModuleList(this.model,this):new CoursePress.UnitSteps(this.model,this),this.unitsview.$el.appendTo(this.unitsContainer)},courseStudentsView:function(){this.students=new CoursePress.Course_Students(this.model,this)},getSteps:function(b){this.steps.push(a(b).data("step"))},getCurrentStep:function(){return this.$('[data-step="'+this.currentStep+'"]')},setCurrentStep:function(a){this.currentStep&&a!==this.firstStep&&(this.trigger("coursepress:validate-"+this.currentStep),!1===this.goToNext)||this.loadCurrentStep(a)},loadCurrentStep:function(a){this.trigger("coursepress:step-before-change",this.currentStep,this),this.currentStep=a,this.trigger("coursepress:step-changed",this.currentStep,this),this.trigger("coursepress:load-step-"+this.currentStep,this),CoursePress.Cookie("course_setup_step_"+this.model.get("ID")).set(this.currentStep,604800)},getCurrentTab:function(){return this.$("#"+this.currentStep)},stepChanged:function(){this.prevButton[this.currentStep===this.firstStep?"hide":"show"](),this.current=this.getCurrentStep(),this.current.siblings().removeClass("active"),this.current.addClass("active"),this.currentTab=this.getCurrentTab(),this.currentTab.siblings().removeClass("tab-active").removeClass("done"),this.currentTab.addClass("tab-active")},toggleContent:function(b){var c=a(b.currentTarget).parent(),d=c.data("step");d!==this.currentStep&&(this.setCurrentStep(d),this.toggleStepList())},getPreviousStep:function(){var a=_.indexOf(this.steps,this.currentStep);a>0&&(a-=1,this.setCurrentStep(this.steps[a]))},_getNextStep:function(){var a,b;return a=_.indexOf(this.steps,this.currentStep),b=this.steps.length-1,a<b&&(a+=1,this.steps[a])},saveCourse:function(a){this.getNextStep(a)},getNextStep:function(a){var b;if(this.senderButton=this.$(a.currentTarget),this.savemode=this.senderButton.is(".step-save")?"save":"continue",b=this._getNextStep()){if(this.trigger("coursepress:validate-"+this.currentStep),!1===this.goToNext)return;if(this.trigger("coursepress:before-next-step-"+this.currentStep,this),!1===this.goToNext)return;this.trigger("coursepress:next-step-activated",b,this),this.currentStep===this.lastStep&&this.trigger("coursepress:lastStepActivated",this.currentStep,this)}this.goNextStep=!1},returnToMainPage:function(){},toggleStepList:function(){this.stepListContainer.toggleClass("open","")},updateCourse:function(){window.alert(this.currentStep),"course-units"!==this.currentStep&&(this.senderButton.addClass("cp-progress"),this.model.set("action","update_course"),this.model.save())},after_update:function(){this.senderButton&&this.senderButton.removeClass("cp-progress")},courseUpdateError:function(){this.after_update(),new CoursePress.PopUp({type:"error",message:c._coursepress.text.server_error})},courseUpdated:function(a){var b;if(a.course){if(a.ID&&c.history.pushState){var d=c._coursepress.pagenow+"&cid="+a.ID;c.history.pushState({},null,d),this.model.set(a.course),this.trigger("coursepress:course_updated",a.ID,a.course)}_.each(a.course,function(a,b){var c;this.model.set(b,a),c=this.$('[name="'+b+'"]'),(!c.length||c.is('[type="checkbox"]'))&&c.is('[type="radio"]')&&c.is("select")||c.val(a)},this)}this.after_update(),"continue"===this.savemode&&(b=this._getNextStep(),this.loadCurrentStep(b))}}),d=new d(c._coursepress.course),c.Course=d})}();