/*! CoursePress - v3.0.0
 * https://premium.wpmudev.org/project/coursepress-pro/
 * Copyright (c) 2017; * Licensed GPLv2+ */
!function(){"use strict";window.CoursePress=function(a,b,c){var d={Events:Backbone.Events||{}};return d.Define=function(e,f){d[e]||(d[e]=f.call(null,a,b,c))},d.Cookie=function(a){var d,e;return d={},e=a+"_"+c._coursepress.cookie.hash,{get:function(){return b.cookie.split(";").map(this.trim).map(this.toObject),d[e]?d[e]:null},set:function(a,d){var f,g;f=new Date,g=f.getTime()+parseInt(d),b.cookie=e+"="+a+";expires="+g+";path="+c._coursepress.cookie.path},unset:function(){},trim:function(a){return a=a.trim()},toObject:function(a){a=a.split("="),d[a[0]]=a[1]}}},d}(jQuery,document,window)}(),function(){"use strict";CoursePress.Define("Request",function(a,b,c){return Backbone.Model.extend({url:c._coursepress.ajaxurl+"?action=coursepress_request",defaults:{_wpnonce:c._coursepress._wpnonce},initialize:function(){this.on("error",this.serverError,this),Backbone.Model.prototype.initialize.apply(this,arguments)},parse:function(a){var b=this.get("action");a.success?this.trigger("coursepress:success_"+b,a.data):this.trigger("coursepress:error_"+b,a.data)},serverError:function(){}})})}(),function(){"use strict";CoursePress.Define("View",function(a,b,c){return _.mixin({isTrue:function(a,b){return _.isArray(b)?_.contains(b,a):_.isObject(b)?!!b[a]:(_.isBoolean(a)&&!_.isBoolean(b)&&(b=parseInt(b,10)>0),a===b)},checked:function(a,b){return _.isTrue(a,b)?"checked=checked":""},selected:function(a,b){return _.isTrue(a,b)?'selected="selected"':""},disabled:function(a,b){return _.isTrue(a,b)?"disabled=disabled":""},_getTemplate:function(b,c){var d={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g},e=a("#"+b);return e.length&&(e=_.template(e.html(),null,d)),e(c)},focus:function(b){var c,d=a(b);return 0<d.length&&(c=d.offset().top,c-=100,a(window).scrollTop(c)),!1}}),Backbone.View.extend({template_id:"",model:{},events:{"change [name]":"updateModel","focus [name]":"removeErrorMarker"},time:10,initialize:function(){arguments&&arguments[0]&&(this.model=new CoursePress.Request(arguments[0])),this.render()},render:function(){if(!_.isEmpty(this.template_id)){var a=this.model.get?this.model.toJSON():this.model;this.$el.html(_._getTemplate(this.template_id,a))}return this.trigger("view_rendered"),CoursePress.Events.trigger("coursepress:view_rendered",this),this},updateModel:function(b){var c,d,e,f;c=a(b.currentTarget),d=c.attr("name"),f=(e=c.attr("type"))&&_.contains(["checkbox","radio"],e)?!!c.is(":checked")&&c.val():c.val(),this.model.get?this.model.set(d,f):this.model[d]=f,this.trigger("coursepress:model_updated",this.model,this),b.stopImmediatePropagation()},removeErrorMarker:function(a){var b=this.$(a.currentTarget),c=b.parents(".cp-error");c.length&&c.removeClass("cp-error")},visualEditor:function(b){this.time+=200,_.delay(function(){var d,e,f,g,h,i,j,k,l,m,n;m=new Date,d="post_editor_"+m.getTime(),e=b.container,l=b.content,c.tinyMCEPreInit&&(i=c.tinyMCEPreInit.mceInit.coursepress_editor,j=c.tinyMCEPreInit.qtInit.coursepress_editor),g="coursepress-visual-editor",f=a("#"+g).html(),f=f.replace(/coursepress_editor/g,d),h={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g},f=_.template(f,null,h),e.html(f),e.find("textarea#"+d).val(l),n=e.find(".wp-editor-wrap").is(".tmce-active"),i.selector="#"+d,j.id=d,c.tinyMCEPreInit.mceInit[d]=i,c.tinyMCEPreInit.qtInit[d]=j,c.tinymce.init(i),c.quicktags(j),k=c.tinymce.get(d),_.delay(function(){n?e.find(".switch-tmce").trigger("click"):e.find(".switch-html").trigger("click")},100),k&&k.on("change",function(){l=k.getContent(),b.callback&&b.callback.call(null,l)}),e.find("textarea#"+d).val(l).on("change",function(){l=a(this).val(),b.callback&&b.callback.call(null,l)})},this.time)}})})}(),function(){"use strict";CoursePress.Define("AddImage",function(a,b,c){var d,e;return e=!1,CoursePress.View.extend({template_id:"coursepress-add-image-tpl",input:!1,events:{"change .cp-image-url":"updateInput","click .cp-btn-browse":"selectImage","click .cp-btn-clear":"clearSelection","focus .cp-image-url":"removeErrorMarker"},data:{size:"thumbnail",title:c._coursepress.text.media.select_image},initialize:function(a){this.input=a.hide(),this.input.data("title")&&(this.data.title=this.input.data("title")),this.input.data("size")&&(this.data.size=this.input.data("size")),this.thumbnail_id=this.input.attr("thumbnail"),this.render()},render:function(){var a,b,c,d,e;c=this.input.data("thumbnail"),d=e=this.input.val(),d||(d=""),b={name:this.input.attr("name"),thumbnail_id:c,value:d},a=_._getTemplate(this.template_id,b),this.setElement(a),this.$el.insertAfter(this.input),this.thumbnail_box=this.$(".cp-thumbnail"),this.image_id_input=this.$(".cp-thumbnail-id"),this.image_id_input.off("change"),this.image_id_input.on("change",this.input.prop("change")),this.image_url_input=this.$(".cp-image-url"),c&&this.image_id_input.val(c),e&&this.setThumbnail(e)},updateInput:function(b){var c=a(b.currentTarget);this.input.val(c.val()),this.input.trigger("change"),e||this.image_id_input.val(0),this.image_id_input.trigger("change")},selectImage:function(){if(c.wp&&c.wp.media){if(!d){var a={frame:"select",title:this.data.title,library:["image"]};d=new wp.media(a),d.on("open",this.openMediaFrame,this),d.on("select",this.setSelectedImage,this)}d.open()}},openMediaFrame:function(){},setSelectedImage:function(){var a,b,c,f;a=d.state().get("selection").first(),c=a.get("id"),e=!0,a.attributes.sizes.thumbnail&&(b=a.attributes.sizes.thumbnail.url,this.setThumbnail(b)),f=a.attributes.url,this.input.val(f),this.image_url_input.val(f),this.image_url_input.trigger("change"),this.image_id_input.val(c),this.image_id_input.trigger("change"),this.input.trigger("change"),e=!1},setThumbnail:function(a){this.thumbnail_box.css("background-image","url("+a+")")},clearSelection:function(){this.image_id_input.val(""),this.image_url_input.val(""),this.input.val(""),this.thumbnail_box.css("background-image","")}})})}(),function(){"use strict";CoursePress.Define("AddVideo",function(a,b,c){var d,e;return e=!1,CoursePress.View.extend({template_id:"coursepress-add-video-tpl",input:!1,events:{"change .cp-video-url":"updateInput","click .cp-btn-browse":"selectVideo","click .cp-btn-clear":"clearSelection"},data:{title:c._coursepress.text.media.select_video},initialize:function(a){this.input=a.hide(),this.input.data("title")&&(this.data.title=this.input.data("title")),this.input.data("size")&&(this.data.size=this.input.data("size")),this.render()},render:function(){var a,b,c;c=this.input.val(),b={name:this.input.attr("name"),value:c},a=_._getTemplate(this.template_id,b),this.setElement(a),this.$el.insertAfter(this.input),this.video_url_input=this.$(".cp-video-url")},updateInput:function(b){var c=a(b.currentTarget);this.input.val(c.val()),this.input.trigger("change")},selectVideo:function(){if(c.wp&&c.wp.media){if(!d){var a={frame:"select",title:this.data.title,library:{type:["video"]}};d=new wp.media(a),d.on("open",this.openMediaFrame,this),d.on("select",this.setSelectedVideo,this)}d.open()}},openMediaFrame:function(){},setSelectedVideo:function(){var a,b;a=d.state().get("selection").first(),a.get("id"),e=!0,void 0!==a.attributes.type&&"video"===a.attributes.type?(b=a.attributes.url,this.input.val(b),this.video_url_input.val(b),this.video_url_input.trigger("change"),this.input.trigger("change")):window.console.log(a),e=!1},clearSelection:function(){this.video_url_input.val(""),this.input.val("")}})})}(),function(){"use strict";CoursePress.Define("DropDownMenu",function(a){var b,c;return b=CoursePress.View.extend({events:{"click .cp-dropdown-btn":"toggleMenu"},render:function(){this.menuList=this.$(".cp-dropdown-menu")},toggleMenu:function(){var b=this.menuList.is(".open");a(".cp-dropdown-menu").not(this.menuList).removeClass("open"),b?this.menuList.removeClass("open"):this.menuList.addClass("open")}}),c=function(a){var c=a.$(".cp-dropdown");c.length&&_.each(c,function(a){new(b.extend({el:a}))})},CoursePress.Events.on("coursepress:view_rendered",c),b})}(),function(){"use strict";CoursePress.Define("PopUp",function(){return CoursePress.View.extend({template_id:"coursepress-popup-tpl",className:"coursepress-popup",events:{"click .btn-ok":"Ok","click .cp-btn-cancel":"remove"},render:function(){CoursePress.View.prototype.render.apply(this),this.$el.appendTo("body")},Ok:function(){this.trigger("coursepress:popup_ok",this),this.remove()}})})}(),function(){"use strict";CoursePress.Define("Upload",function(a,b,c){return CoursePress.Request.extend({url:c._coursepress.ajaxurl+"?action=coursepress_upload",parse:function(a){var b=this.get("type");a.success?this.trigger("coursepress:success_"+b,a.data):this.trigger("coursepress:error_"+b,a.data)},upload:function(){var b=this.toJSON();this.save(b,{iframe:!0,files:a(":file"),data:b})}})})}(),function(){"use strict";CoursePress.Define("AddMedia",function(a,b,c){var d;return CoursePress.View.extend({template_id:"coursepress-add-media-tpl",className:"cp-add-media-box",type:"video",events:{"click .cp-browse-btn":"toggleFrame"},initialize:function(a){this.element=a,this.data=a.data(),this.model={placeholder:a.data("placeholder")},this.on("view_rendered",this.setUI,this),this.render()},setUI:function(){this.element.hide(),this.$el.insertAfter(this.element),this.input=this.$(".cp-add-media-input"),this.input.val(this.element.val())},toggleFrame:function(){if(c.wp&&c.wp.media){if(!d){var a={frame:"select",title:this.data.title,library:{type:[this.data.type]}};d=new wp.media(a),d.on("select",this.setSelected,this)}d.open()}},setSelected:function(){var a;a=d.state().get("selection").first(),a.get("id"),this.input.val(a.attributes.url),this.element.val(a.attributes.url),this.element.trigger("change")}})})}();