/*!  - v2.0.0
 * 
 * Copyright (c) 2016; * Licensed GPLv2+ */
var CoursePress={};CoursePress.Events=_.extend({},Backbone.Events),CoursePress.SendRequest=Backbone.Model.extend({url:_coursepress._ajax_url+"?action=coursepress_request",parse:function(a){var b=this.get("action");!0===a.success?(this.set("response_data",a.data),this.trigger("coursepress:"+b+"_success",a.data)):(this.set("response_data",{}),this.trigger("coursepress:"+b+"_error",a.data))}}),CoursePress.resetBrowserURL=function(a){window.history.pushState&&window.history.pushState({},null,a)},function(a){CoursePress.LoadFocusModule=function(){var b=a(this),c=b.data(),d=a(".coursepress-focus-view"),e=[_coursepress.home_url,"coursepress_focus"];if("submit"!==b.attr("type"))return"course"===c.type?void(window.location=c.url):(e.push(c.course,c.unit,c.type,c.id),e=e.join("/"),d.load(e),CoursePress.resetBrowserURL(c.url),!1)},CoursePress.ModuleSubmit=function(){var b=a(this),c=b.find(".cp-error"),d=b.parents(".coursepress-focus-view"),e=!1,f=!1;b.append('<input type="hidden" name="is_cp_ajax" value="1" />'),e=a('<iframe name="cp_submitter" style="display:none;">').insertBefore(b),b.attr("target","cp_submitter"),e.on("load",function(){var b=a(this).contents().find("body");f=setInterval(function(){var a=b.text();if(""!=a){clearInterval(f);var e=window.JSON.parse(a);!0===e.success?e.data.url&&(e.data.type&&"completion"===e.data.type?window.location=e.data.url:(d.html(e.data.html),CoursePress.resetBrowserURL(e.data.url))):(c.empty().append(e.data.error_message),d.html(e.data.html))}},100)})},CoursePress.toggleModuleState=function(){var b=a(this),c=b.closest(".cp-module-content"),d=a(".module-elements",c),e=a(".module-response",c);return e.hide(),d.show(),!1},a(document).on("submit",".cp-form",CoursePress.ModuleSubmit).on("click",".focus-nav-prev, .focus-nav-next",CoursePress.LoadFocusModule).on("click",".button-reload-module",CoursePress.toggleModuleState)}(jQuery);