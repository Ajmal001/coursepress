/*!  - v2.0.0
 * 
 * Copyright (c) 2016; * Licensed GPLv2+ */
var CoursePress=CoursePress||{};(function(e){function s(){var s=e('[data-type="modal-step"]');void 0!==s&&s.length&&(CoursePress.Enrollment.Modal=Backbone.Modal.extend({template:_.template(e("#modal-template").html()),viewContainer:".enrollment-modal-container",submitEl:".done",cancelEl:".cancel",options:"meh",views:function(){var t={};return e.each(s,function(s,r){var o=s+1,n=e(r).attr("id");void 0!==n&&(t["click #step"+o]={view:_.template(e("#"+n).html()),onActive:"setActive"})}),t}(),events:{"click .previous":"previousStep","click .next":"nextStep","click .cancel-link":"closeDialog"},previousStep:function(e){e.preventDefault(),this.previous(),"function"==typeof this.onPrevious&&this.onPrevious()},nextStep:function(e){e.preventDefault(),this.next(),"function"==typeof this.onNext&&this.onNext()},closeDialog:function(){e(".enrolment-container-div").detach()},setActive:function(e){window.console.log(e),this.trigger("modal:updated",{view:this,options:e})}}),CoursePress.Enrollment.dialog=new CoursePress.Enrollment.Modal,CoursePress.Enrollment.dialog.beforeSubmit=function(){var s=this.currentIndex;return r(s),s===CoursePress.Enrollment.dialog.views.length-1&&e(".enrolment-container-div").addClass("hidden"),!1},CoursePress.Enrollment.dialog.openAtAction=function(s){var t=e('[data-type="modal-step"]');e.each(t,function(t,r){var o=e(r).attr("data-modal-action");void 0!==o&&s===o&&CoursePress.Enrollment.dialog.openAt(t)})},CoursePress.Enrollment.dialog.on("modal:updated",function(){}),CoursePress.Enrollment.dialog.handle_signup_return=function(s){var t=s.signup_errors;if(0===t.length&&s.user_data.logged_in===!0)_coursepress.invitation_data?CoursePress.Enrollment.dialog.add_instructor(s):CoursePress.Enrollment.dialog.attempt_enroll(s);else if(t.length>0){e(".bbm-wrapper #error-messages").html("");var r="<ul>";t.forEach(function(e){r+="<li>"+e+"</li>"}),r+="</ul>",e(".bbm-wrapper #error-messages").html(r),e("input[name=password]").val(""),e("input[name=password_confirmation]").val("")}else{var o=e('[data-type="modal-step"]');e.each(o,function(e,s){var t=s.attr("data-modal-action");"login"===t&&CoursePress.Enrollment.dialog.openAt(e)})}},CoursePress.Enrollment.dialog.handle_login_return=function(e){e.logged_in===!0&&(_coursepress.invitation_data?CoursePress.Enrollment.dialog.add_instructor(e):e.already_enrolled?location.href=_coursepress.course_url:CoursePress.Enrollment.dialog.attempt_enroll(e))},CoursePress.Enrollment.dialog.handle_enroll_student_return=function(s){var t=e('[data-type="modal-step"]');!0===s.success&&e.each(t,function(s,t){var r=e(t).attr("data-modal-action");_coursepress.current_course_is_paid&&"paid_enrollment"===r?CoursePress.Enrollment.dialog.openAt(s):"enrolled"===r&&CoursePress.Enrollment.dialog.openAt(s)}),e(".enrolment-container-div").removeClass("hidden")},CoursePress.Enrollment.dialog.signup_validation=function(){var s=!0;e(".bbm-wrapper #error-messages").html("");var t=[];(""===e("input[name=first_name]").val().trim()||""===e("input[name=last_name]").val().trim()||""===e("input[name=username]").val().trim()||""===e("input[name=email]").val().trim()||""===e("input[name=password]").val().trim()||""===e("input[name=password_confirmation]").val().trim())&&(s=!1,t.push(_coursepress.signup_errors.all_fields));var r=CoursePress.utility.checkPasswordStrength(e("input[name=password]"),e("input[name=password_confirmation]"),e("#password-strength"),!1,[]);if(2>=r&&(s=!1,t.push(_coursepress.signup_errors.weak_password)),5===r&&(s=!1,t.push(_coursepress.signup_errors.mismatch_password)),t.length>0){var o="<ul>";t.forEach(function(e){o+="<li>"+e+"</li>"}),o+="</ul>",e(".bbm-wrapper #error-messages").html(o)}return s},CoursePress.Enrollment.dialog.login_validation=function(){var s=!0;return e(".bbm-wrapper #error-messages").html(""),(""===e("input[name=log]").val().trim()||""===e("input[name=pwd]").val().trim())&&(s=!1),s},CoursePress.Enrollment.dialog.signup_data=function(s){return s.first_name=e("input[name=first_name]").val(),s.last_name=e("input[name=last_name]").val(),s.username=e("input[name=username]").val(),s.email=e("input[name=email]").val(),s.password=e("input[name=password]").val(),s.nonce=e(".bbm-modal-nonce.signup").attr("data-nonce"),s},CoursePress.Enrollment.dialog.login_data=function(s){var t=e(".enrollment-modal-container.bbm-modal__views").attr("data-course");return s.username=e("input[name=log]").val(),s.password=e("input[name=pwd]").val(),s.course_id=t,s.nonce=e(".bbm-modal-nonce.login").attr("data-nonce"),s},CoursePress.Enrollment.dialog.attempt_enroll=function(s){var t=e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce"),r=e(".enrollment-modal-container.bbm-modal__views").attr("data-course");if(void 0===t||void 0===r){var o=e(document.createElement("div"));o.html(_.template(e("#modal-template").html())()),o=e(o).find(".enrollment-modal-container")[0],t=e(o).attr("data-nonce"),r=e(o).attr("data-course")}window.console.log("-------=======------=======------========--------"),CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","enroll_student");var n={nonce:t,student_id:s.user_data.ID,course_id:r,step:""};window.console.log(n),CoursePress.Post.set("data",n),CoursePress.Post.save(),CoursePress.Post.off("coursepress:enrollment:enroll_student_success"),CoursePress.Post.on("coursepress:enrollment:enroll_student_success",function(s){if(e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce",s.nonce),window.console.log(s),void 0!==s.callback){var t=CoursePress.Enrollment.dialog[s.callback];if("function"==typeof t)return window.console.log("callback is next...."+s.callback),t(s),void 0}})},CoursePress.Enrollment.dialog.new_nonce=function(e,s){CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","get_nonce");var t={action:"get_nonce",nonce:e,step:""};CoursePress.Post.set("data",t),CoursePress.Post.save(),CoursePress.Post.off("coursepress:enrollment:get_nonce_success"),CoursePress.Post.on("coursepress:enrollment:get_nonce_success",s)},CoursePress.Enrollment.dialog.add_instructor=function(e){CoursePress.Enrollment.dialog.new_nonce("coursepress_add_instructor",function(s){var t=_coursepress.invitation_data.course_id;CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","add_instructor");var r={action:"add_instructor",nonce:s.nonce,course_id:t,invite_code:_coursepress.invitation_data.code,instructor_id:e.user_data.ID,step:""};CoursePress.Post.set("data",r),CoursePress.Post.save(),CoursePress.Post.off("coursepress:enrollment:add_instructor_success"),CoursePress.Post.on("coursepress:enrollment:add_instructor_success",function(){CoursePress.Enrollment.dialog.openAtAction("instructor-verified")}),CoursePress.Post.off("coursepress:enrollment:add_instructor_error"),CoursePress.Post.on("coursepress:enrollment:add_instructor_error",function(){CoursePress.Enrollment.dialog.openAtAction("verification-failed")})})},e("body").on("keyup","input[name=password], input[name=password_confirmation]",function(){CoursePress.utility.checkPasswordStrength(e("input[name=password]"),e("input[name=password_confirmation]"),e("#password-strength"),!1,[])}))}function t(){var s=e(document.createElement("div"));if(e("body").append(s),e(s).addClass("enrolment-container-div"),window.console.log("student: "+_coursepress.current_student),_coursepress.current_student>0)if(_coursepress.current_course_is_paid)window.console.log("open at paid_enrollment"),e(s).html(CoursePress.Enrollment.dialog.render().el),CoursePress.Enrollment.dialog.openAtAction("paid_enrollment");else{e(s).addClass("hidden");var t={user_data:{ID:parseInt(_coursepress.current_student)}};CoursePress.Enrollment.dialog.attempt_enroll(t),e(s).html(CoursePress.Enrollment.dialog.render().el)}else e(s).html(CoursePress.Enrollment.dialog.render().el)}function r(s){if(void 0===s)return!1;var t,r=e(e('[data-type="modal-step"]')[s]).attr("data-modal-action"),o=e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce");if(CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action",r),!("signup"===r&&(t=CoursePress.Enrollment.dialog.signup_validation,"function"==typeof t&&!0!==t())||"login"===r&&(t=CoursePress.Enrollment.dialog.login_validation,"function"==typeof t&&!0!==t()))){var n={nonce:o,step:s};t=CoursePress.Enrollment.dialog[r+"_data"],"function"==typeof t&&(n=t(n)),CoursePress.Post.set("data",n),CoursePress.Post.save(),CoursePress.Post.on("coursepress:enrollment:"+r+"_success",function(s){return e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce",s.nonce),window.console.log(s),void 0!==s.callback&&(t=CoursePress.Enrollment.dialog[s.callback],"function"==typeof t)?(window.console.log("callback is next...."+s.callback),t(s),void 0):(void 0!==s.last_step&&parseInt(s.last_step)<CoursePress.Enrollment.dialog.views.length-1&&(CoursePress.Enrollment.dialog.openAt(parseInt(s.last_step)+1),e(".enrolment-container-div").removeClass("hidden")),void 0)}),CoursePress.Post.on("coursepress:enrollment:"+r+"_error",function(e){return void 0!==e.callback&&(t=CoursePress.Enrollment.dialog[e.callback],"function"==typeof t)?(t(e),void 0):void 0})}}function o(){CoursePress.Post.on("coursepress:notification:delete_success",function(){window.location.reload()})}function n(){e(".unit-archive-list-wrapper .section-title").on("click",function(){var s=e(e(e(this).parents(".unit-archive-single")[0]).find("a.unit-archive-single-title")[0]).attr("href"),t="section-"+e(this).attr("data-id");window.location.href=s+"#"+t}),e(".unit-archive-list-wrapper .module-title").on("click",function(){var s=e(e(e(this).parents(".unit-archive-single")[0]).find("a.unit-archive-single-title")[0]).attr("href"),t="module-"+e(this).attr("data-id");window.location.href=s+"#"+t}),e(".apply-button.signup, .apply-button.enroll").on("click",function(e){e=e||window.event,e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t()}),e(".apply-button").on("click",function(s){var t=s.currentTarget;e(t).attr("data-link")&&(window.location.href=e(t).attr("data-link"))}),e("button").on("click",function(s){var t=s.currentTarget;e(t).attr("data-link")&&(window.location.href=e(t).attr("data-link"))}),e(".course_list_box_item.clickable").on("click",function(s){var t=s.currentTarget;e(t).attr("data-link")&&(window.location.href=e(t).attr("data-link"))}),e(".li-locked-unit a").on("click",function(e){e.stopImmediatePropagation(),e.preventDefault()}),e(".workbook-table .view-response").link_popup({link_text:'<span class="dashicons dashicons-visibility"></span>',offset_x:-160}),e(".workbook-table .feedback").link_popup({link_text:'<span class="dashicons dashicons-admin-comments"></span>'})}function a(){e(".module-container .module-result .resubmit a").on("click",function(){var s=e(this).parents(".module-container"),t=e(s).find(".module-elements"),r=e(s).find(".module-response"),o=e(s).find(".module-result");e(t).removeClass("hide"),e(r).addClass("hide"),e(o).addClass("hide")}),e(".module-container input[type=file]").on("change",function(){var s=e(this).parents(".module-container"),t=e(this).val(),r=t.split(".").pop(),o=_.keys(_coursepress.allowed_student_extensions),n=o.join(", "),a=e(s).find(".upload-progress"),i=_.contains(o,r);e(a).find(".invalid-extension").detach(),i||e(a).append('<span class="invalid-extension">'+_coursepress.invalid_upload_message+n+"</span>")}),e(".module-submit-action").on("click",function(){var s=this,t=e(s).parents(".module-container"),r=e(t).find(".module-elements"),o=e(t).find(".module-response"),n=e(t).find(".module-result"),a=e(t).attr("data-module"),c=e(t).attr("data-type"),u=e(t).find("[name=course_id]").val(),d=e(t).find("[name=unit_id]").val(),l=e(t).find("[name=student_id]").val(),p="",m=!1;switch(c){case"input-checkbox":p=[],e.each(e(t).find('[name="module-'+a+'"]:checked'),function(s,t){p.push(e(t).val())}),m=0===p.length;break;case"input-radio":s=e(t).find('[name="module-'+a+'"]:checked'),s?p=e(s).val():m=!0;break;case"input-select":p=e(t).find("[name=module-"+a+"]").val();break;case"input-text":p=e(t).find("[name=module-"+a+"]").val(),m=0===p.trim().length;break;case"input-textarea":p=e(t).find("[name=module-"+a+"]").val(),m=0===p.trim().length;break;case"input-quiz":p=[];var f=e(t).find(".module-quiz-question");e.each(f,function(s,t){var r=e(t).find('[type="checkbox"],[type="radio"]');p[s]=[],e.each(r,function(t,r){p[s][t]=e(r).is(":checked")})});break;case"input-upload":if(i()){var v=new FormData,h=e(t).find("[name=module-"+a+"]")[0].files[0],C=h.name.split(".").pop(),g=_.keys(_coursepress.allowed_student_extensions),P=_.contains(g,C);if(!P)return;var b="";v.append("course_action","upload-file"),v.append("course_id",u),v.append("unit_id",d),v.append("module_id",a),v.append("student_id",l),v.append("src","ajax"),v.append("file",h);var w=new XMLHttpRequest;w.upload.addEventListener("loadstart",function(){var s=e(t).find(".upload-progress");e(s).find(".spinner").detach(),e(s).append('<span class="image spinner">&#xf111</span>')},!1),w.upload.addEventListener("progress",function(s){var r=100*(s.loaded/s.total),o=e(t).find(".upload-percent");r=parseInt(r),o.length>0?e(o).replaceWith('<span class="upload-percent">'+r+"%</span>"):e(t).find(".upload-progress").append('<span class="upload-percent">'+r+"%</span>")},!1),w.upload.addEventListener("load",function(){},!1),w.addEventListener("readystatechange",function(s){var a,i;try{i=s.target.readyState,a=s.target.status}catch(c){return}var u={success:!1};try{u=JSON.parse(s.target.responseText)}catch(c){}4===i&&"200"===a&&u.success?(e(t).find(".upload-percent").detach(),e(t).find(".upload-progress .spinner").detach(),e(n).detach(),e(r).addClass("hide"),e(o).replaceWith('<div class="module-response"><p class="file_holder">'+_coursepress.file_uploaded_message+"</p>"+"</div>")):4===i&&(e(t).find(".upload-percent").detach(),e(t).find(".upload-progress .spinner").detach(),e(n).detach(),e(r).addClass("hide"),e(o).replaceWith('<div class="module-response"><p class="file_holder">'+_coursepress.file_upload_fail_message+"</p>"+"</div>"))},!1),w.open("POST",b,!0),w.send(v)}else e(t).find("form").submit();return}if(!m){e(r).find(".response-processing").detach(),e(r).find(".module-submit-action").append('<span class="response-processing image spinner">&#xf111</span>');var k=new CoursePress.Models.CourseFront;k.set("action","record_module_response"),k.set("course_id",u),k.set("unit_id",d),k.set("module_id",a),k.set("student_id",l),k.set("response",p),k.set("module_type",c),k.save(),k.on("coursepress:record_module_response_success",function(s){window.console.log(s),e(r).find(".response-processing").detach(),e(n).detach(),e(r).addClass("hide");var a="";null!=s.quiz_result_screen&&s.quiz_result_screen.length>0?(e(".coursepress-focus-view .not-active").removeClass("not-active"),a=s.quiz_result_screen,s.results.attributes.mandatory&&!s.results.passed&&e(".coursepress-focus-view .focus-nav-next").addClass("not-active")):a='<div class="module-response"><p class="file_holder">'+_coursepress.response_saved_message+"</p>"+"</div>",0===o.length?e(t).append(a):e(o).replaceWith(a)}),k.on("coursepress:record_module_response_error",function(){e(r).find(".response-processing").detach(),e(n).detach(),e(r).addClass("hide");var s='<div class="module-response"><p class="file_holder">'+_coursepress.response_fail_message+"</p>"+"</div>";0===o.length?e(t).append(s):e(o).replaceWith(s)})}})}function i(){function e(){var e=document.createElement("INPUT");return e.type="file","files"in e}function s(){var e=new XMLHttpRequest;return!!(e&&"upload"in e&&"onprogress"in e.upload)}function t(){return!!window.FormData}return e()&&s()&&t()}function c(){var e=new CoursePress.Models.CourseFront;e.set("action","calculate_completion"),e.set("course_id",_coursepress.current_course),e.set("student_id",_coursepress.current_student),e.save()}function u(){var s=e("ul.units-archive-list a").css("color"),t=e("body").css("color").replace("rgb(","").replace(")","").split(","),r={color:s},o=e(".course-progress-disc").circleProgress({fill:r,emptyFill:"rgba("+t[0]+", "+t[1]+", "+t[2]+", .1)"});e.each(o,function(s,t){var r=e(t).parents("ul")[0],o=e(r).find("a").css("color");e(t).on("circle-animation-progress",function(s,t){var r=e(this).data("circle-progress"),o=r.ctx,n=r.size,a=(100*t).toFixed(),i=(100*r.value).toFixed(),c=r.arcFill;a=100-a,i>a&&(a=i),o.save(),o.font=n/4.5+"px sans-serif",o.textAlign="center",o.textBaseline="middle",o.fillStyle=c,o.fillText(a+"%",n/2+n/80,n/2),o.restore()}),e(t).on("circle-animation-end",function(){var s=e(this).data("circle-progress"),t=s.ctx,r=s.size,n=(100*s.value).toFixed();s.drawFrame(s.value),t.font=r/4.5+"px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillStyle=o,t.fillText(n+"%",r/2,r/2)});var n=e(t).data("circle-progress"),a=n.ctx,i=n.size,c=(100*n.value).toFixed(),u=n.arcFill;a.font=i/4.5+"px sans-serif",a.textAlign="center",a.textBaseline="middle",a.fillStyle=u,a.fillText(c+"%",i/2,i/2+i/80)})}function d(){e(".course-discussion-content.new .button-links .submit-discussion").on("click",function(){e(this).parents("form").submit()})}function l(){var s=e(".coursepress-focus-view");void 0!==s&&s.length>0&&CoursePress.FocusMode.init_focus_mode()}CoursePress.Models=CoursePress.Models||{},CoursePress.UI=CoursePress.UI||{},CoursePress.utility=CoursePress.utility||{},CoursePress.utility.timer_validate=function(e,s){var t="ref_"+(CoursePress.utility.hashcode(""+e)+"").split("").reverse().join("");return t===s},CoursePress.utility.checkPasswordStrength=function(e,s,t,r,o){var n=e.val(),a=s.val();r&&r.attr("disabled","disabled"),t.removeClass("short bad good strong"),o=o.concat(wp.passwordStrength.userInputBlacklist());var i=wp.passwordStrength.meter(n,o,a);switch(i){case 2:t.addClass("bad").html(pwsL10n.bad);break;case 3:t.addClass("good").html(pwsL10n.good);break;case 4:t.addClass("strong").html(pwsL10n.strong);break;case 5:t.addClass("short").html(pwsL10n.mismatch);break;default:t.addClass("short").html(pwsL10n.short)}return r&&i>2&&5!==i&&""!==a.trim()&&r.removeAttr("disabled"),i},CoursePress.utility.addComment={moveForm:function(e,s,t,r){var o,n=this,a=n.I(e),i=n.I(t),c=n.I("cancel-comment-reply-link"),u=n.I("comment_parent"),d=n.I("comment_post_ID");if(a&&i&&c&&u){n.respondId=t,r=r||!1,n.I("wp-temp-form-div")||(o=document.createElement("div"),o.id="wp-temp-form-div",o.style.display="none",i.parentNode.insertBefore(o,i)),a.parentNode.insertBefore(i,a.nextSibling),d&&r&&(d.value=r),u.value=s,c.style.display="",c.onclick=function(){var e=CoursePress.utility.addComment,s=e.I("wp-temp-form-div"),t=e.I(e.respondId);if(s&&t)return e.I("comment_parent").value="0",s.parentNode.insertBefore(t,s),s.parentNode.removeChild(s),this.style.display="none",this.onclick=null,!1};try{n.I("comment").focus()}catch(l){}return!1}},I:function(e){return document.getElementById(e)}},CoursePress.actions=CoursePress.actions||{},CoursePress.filters=CoursePress.filters||{},CoursePress.add_action=function(e,s,t){void 0===t&&(t=10),CoursePress.actions[e]=CoursePress.actions[e]||[],CoursePress.actions[e].push({priority:t,callback:s})},CoursePress.add_filter=function(e,s,t){void 0===t&&(t=10),CoursePress.filters[e]=CoursePress.filters[e]||[],CoursePress.filters[e].push({priority:t,callback:s})},CoursePress.remove_action=function(e,s){CoursePress.filters[e]=CoursePress.filters[e]||[],CoursePress.filters[e].forEach(function(t,r){t.callback===s&&CoursePress.filters[e].splice(r,1)})},CoursePress.remove_filter=function(e,s){CoursePress.filters[e]=CoursePress.filters[e]||[],CoursePress.filters[e].forEach(function(t,r){t.callback===s&&CoursePress.filters[e].splice(r,1)})},CoursePress.do_action=function(e,s){var t=[];void 0!==CoursePress.actions[e]&&CoursePress.actions[e].length>0&&(CoursePress.actions[e].forEach(function(e){t[e.priority]=t[e.priority]||[],t[e.priority].push(e.callback)}),t.forEach(function(e){e.forEach(function(e){e(s)})}))},CoursePress.apply_filters=function(e,s,t){var r=[];return void 0!==CoursePress.filters[e]&&CoursePress.filters[e].length>0&&(CoursePress.filters[e].forEach(function(e){r[e.priority]=r[e.priority]||[],r[e.priority].push(e.callback)}),r.forEach(function(e){e.forEach(function(e){s=e(s,t)})})),s},CoursePress.Models.CourseFront=Backbone.Model.extend({url:_coursepress._ajax_url+"?action=course_front",parse:function(e){!0===e.success?(this.set("response_data",e.data),this.trigger("coursepress:"+e.data.action+"_success",e.data)):(this.set("response_data",{}),e.data&&this.trigger("coursepress:"+e.data.action+"_error",e.data))},defaults:{}}),CoursePress.Models.Post=CoursePress.Models.Post||Backbone.Model.extend({url:_coursepress._ajax_url+"?action=",parse:function(e){var s=this.get("context");if(!0===e.success){void 0===e.data&&(e.data={}),this.set("response_data",e.data);var t="coursepress:"+s+e.data.action+"_success";this.trigger(t,e.data)}else 0!==e&&(this.set("response_data",{}),this.trigger("coursepress:"+s+e.data.action+"_error",e.data));CoursePress.Post.set("action","")},prepare:function(e,s){this.url=this.get("base_url")+e,void 0!==s&&this.set("context",s)},defaults:{base_url:_coursepress._ajax_url+"?action=",context:"response:"}}),CoursePress.Post=new CoursePress.Models.Post,CoursePress.Enrollment=CoursePress.Enrollment||{},CoursePress.Page=CoursePress.Page||{},CoursePress.Enrollment.dialog=CoursePress.Enrollment.dialog||{},CoursePress.FocusMode=CoursePress.FocusMode||{},CoursePress.FocusMode.bind_focus_nav=function(){e(".coursepress-focus-view .focus-nav-prev").off("click"),e(".coursepress-focus-view .focus-nav-next").off("click"),e(".coursepress-focus-view a.breadcrumb-course-unit-section.crumb").off("click"),e(".coursepress-focus-view .focus-nav-prev, .coursepress-focus-view .focus-nav-next").on("click",function(){var s=e(this).attr("data-type"),t=e(this).attr("data-id");e(".coursepress-focus-view .loader").removeClass("hidden"),e(".coursepress-focus-view .focus-main").hide("fast");var r=0;r=e(".entry-title").length>0?e(".entry-title").offset().top-32:32,r=CoursePress.apply_filters("coursepress_focus_top_offset",r),e("body,html").animate({scrollTop:r,duration:100}),CoursePress.FocusMode.load_focus_item(s,t)}),e("a.breadcrumb-course-unit-section.crumb, a.breadcrumb-course-unit.crumb").on("click",function(){var s="section",t=e(this).attr("data-id");e(".coursepress-focus-view .loader").removeClass("hidden"),e(".coursepress-focus-view .focus-main").hide("fast");var r=0;r=e(".entry-title").length>0?e(".entry-title").offset().top-32:32,r=CoursePress.apply_filters("coursepress_focus_top_offset",r),e("body,html").animate({scrollTop:r,duration:100}),CoursePress.FocusMode.load_focus_item(s,t)})},CoursePress.FocusMode.load_focus_item=function(s,t){CoursePress.Post.prepare("course_front","focus:"),CoursePress.Post.set("action","get_unit_"+s),(void 0===t||0===t.length)&&(t=1);var r=e(".coursepress-focus-view"),o={course_id:e(r).attr("data-course"),unit_id:e(r).attr("data-unit"),type:s,item_id:t};e(".coursepress-focus-view").load(_coursepress.home_url+"/coursepress_focus/"+o.course_id+"/"+o.unit_id+"/"+o.type+"/"+o.item_id,function(){CoursePress.FocusMode.bind_focus_nav(),CoursePress.Page.init(),e("audio").css("visibility","visible"),e("audio").css("outline","none"),e(".quiz_timer").coursepress_timer({toggle_element:e(".quiz_timer").siblings(".module-quiz-questions"),seconds:parseInt(e(".quiz_timer").attr("data-time")),action:"none",running:!1}),e(".quiz_timer").on("timer_started",function(){window.console.log("IT HAS STARTED!")}),e(".quiz_timer").on("timer_ended",function(){window.console.log("IT HAS FINISHED!")}),e(".coursepress-focus-view .comment-reply-link").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation()})})},CoursePress.FocusMode.init_focus_mode=function(){var s,t=null!==location.hash.match(/^#module-/),r=null!==location.hash.match(/^#section-/);if(t||r||(r=!0),t&&(s=location.hash.replace("#module-",""),CoursePress.FocusMode.load_focus_item("module",s)),r){if(s=location.hash,void 0===s||0===s.length){var o=e(".coursepress-focus-view");s=e(o).attr("data-page")}s=s.replace("#section-",""),CoursePress.FocusMode.load_focus_item("section",s)}},CoursePress.Page.init=function(){var s=e(".coursepress-focus-view").length>0;n(),a(),d(),u(),s||(e(".quiz_timer").coursepress_timer(),e(".quiz_timer").on("timer_started",function(){window.console.log("IT HAS STARTED!")}),e(".quiz_timer").on("timer_ended",function(){window.console.log("IT HAS FINISHED!")}))},e(document).ready(function(){CoursePress.Page.init(),s(),l(),c(),o()})})(jQuery),CoursePress.current=CoursePress.current||{};