/*! CoursePress - v2.0.0-BETA3
 * http://premium.wpmudev.org
 * Copyright (c) 2016; * Licensed GPLv2+ */
var CoursePress=CoursePress||{};!function(a){CoursePress.Models.Course=CoursePress.Models.Course||Backbone.Model.extend({url:_coursepress._ajax_url+"?action=update_course",parse:function(a){!0===a.success?(this.set("response_data",a.data),this.trigger("coursepress:"+a.data.action+"_success",a.data)):(this.set("response_data",{}),this.trigger("coursepress:"+a.data.action+"_error",a.data)),CoursePress.Course.set("action","")},defaults:{}}),CoursePress.Course=new CoursePress.Models.Course,a(document).ready(function(a){a('[name*="publish-course-toggle"]').on("change",function(b,c){var d=a(this).attr("data-nonce"),e="off"===c?"draft":"publish",f=parseInt(a(this).attr("id").replace("publish-course-toggle-",""));CoursePress.Course.set("action","toggle_course_status");var g={nonce:d,status:e,state:c,course_id:f};CoursePress.Course.set("data",g),CoursePress.Course.save()}),CoursePress.Course.on("coursepress:toggle_course_status_success",function(b){a('[name="publish-course-toggle-'+b.course_id+'"]').attr("data-nonce",b.nonce)}),CoursePress.Course.on("coursepress:toggle_course_status_error",function(b){var c=a('[name="publish-course-toggle-'+b.course_id+'"]');a(c).hasClass("on")?a(c).removeClass("on").addClass("off"):a(c).hasClass("off")&&a(c).removeClass("off").addClass("on")}),a(".bulkactions .button.action").on("click",function(){var b=a(".nonce-holder").attr("data-nonce"),c=[];a.each(a('[name="bulk-actions[]"]'),function(b,d){a(d).is(":checked")&&c.push(a(d).val())});var d=a(this).siblings("select").val();d="-1"===d?"":d;var e=!0;if("delete"===d&&(e=window.confirm(_coursepress.courselist_bulk_delete)),"export"===d)return 0===c.length?(alert(_coursepress.courselist_export),!1):(window.location="./admin.php?page=coursepress_export_import&courses="+c.join()+"&_wpnonce="+b+"&source=list",!1);if(d.length>0&&e){CoursePress.Course.set("action","bulk_actions");var f={nonce:b,the_action:d,courses:c};CoursePress.Course.set("data",f),CoursePress.Course.save()}}),CoursePress.Course.on("coursepress:bulk_actions_success",function(b){a(".nonce-holder").attr("data-nonce",b.nonce),window.location.reload()}),CoursePress.Course.on("coursepress:bulk_actions_error",function(){window.location.reload()}),a(".delete-course-link").on("click",function(b){b.stopImmediatePropagation(),b.preventDefault();var c=a(this),d=c.parents("tr").first();if(window.confirm(_coursepress.courselist_delete_course)){CoursePress.Course.set("action","delete_course");var e={nonce:a(this).attr("data-nonce"),course_id:a(this).attr("data-id")};d.slideUp(),CoursePress.Course.set("data",e),CoursePress.Course.save(),CoursePress.Course.off("coursepress:delete_course_success"),CoursePress.Course.on("coursepress:delete_course_success",function(){d.remove()}),CoursePress.Course.on("coursepress:delete_course_error",function(){d.slideUp(),alert(_coursepress.server_error)})}}),a(".duplicate-course-link").on("click",function(b){b.stopImmediatePropagation(),b.preventDefault();var c=a(this),d=c.parents("tr").first();if(window.confirm(_coursepress.courselist_duplicate_course)){CoursePress.Course.set("action","duplicate_course");var e={nonce:a(this).attr("data-nonce"),course_id:a(this).attr("data-id")};d.addClass("duplicating"),CoursePress.Course.set("data",e),CoursePress.Course.save(),CoursePress.Course.off("coursepress:duplicate_course_success"),CoursePress.Course.on("coursepress:duplicate_course_success",function(){window.location.reload()})}}),a(".coursepress-ui-toggle-switch").coursepress_ui_toggle()})}(jQuery);