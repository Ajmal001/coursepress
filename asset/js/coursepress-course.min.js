/*!  - v2.0.0
 * 
 * Copyright (c) 2016; * Licensed GPLv2+ */
var CoursePress=CoursePress||{};CoursePress.Events=CoursePress.Events||_.extend({},Backbone.Events),function(e){function s(){e.each(e(".step-content .course-structure tr.unit"),function(s,t){var r;if(r=e(t).attr("class").match(/treegrid-\d{1,10}/g)[0]){var n=r.trim().split("-").pop(),a=".step-content .course-structure tr.page.treegrid-parent-"+n,o=e(a);e.each(o,function(s,t){var r=e(t).attr("class").match(/treegrid-\d{1,10}/g)[0].trim().split("-").pop(),n=".step-content .course-structure tr.module.treegrid-parent-"+r,a=n+' [name*="meta_structure_visible_modules"]',o=e(a).length,i=e(a+":checked").length;e(".step-content .course-structure .treegrid-"+r+" [name*=meta_structure_visible_pages]").prop("checked",o===i&&i>0);var c=n+' [name*="meta_structure_preview_modules"]',u=e(c).length,d=e(c+":checked").length;e(".step-content .course-structure .treegrid-"+r+" [name*=meta_structure_preview_pages]").prop("checked",u===d&&d>0)});var i=a+' [name*="meta_structure_visible_pages"]',c=e(i).length,u=e(i+":checked").length;e(".step-content .course-structure .treegrid-"+n+" [name*=meta_structure_visible_units]").prop("checked",c===u&&u>0);var d=a+' [name*="meta_structure_preview_pages"]',p=e(d).length,l=e(d+":checked").length;e(".step-content .course-structure .treegrid-"+n+" [name*=meta_structure_preview_units]").prop("checked",p===l&&l>0)}})}function t(){e("#course-setup-steps").accordion({disabled:!0,autoHeight:!1,collapsible:!0,heightStyle:"content",active:0,animate:200}),_coursepress.course_title&&(e(".coursepress_settings_wrapper h1").append(": <small>"+_coursepress.course_title+"</small>"),e("#course_name").on("change",function(){e(".coursepress_settings_wrapper h1 small").html(e(this).val())})),e("#course-setup-steps .step-title").bind("click",function(){var s=jQuery(this),t=parseInt(s.attr("class").match(/step-\d{1,10}/g)[0].trim().split("-").pop()),r=t-1>1?t-1:1;return s.find(".status").hasClass("saved")||e(".step-title.step-"+r).find(".status").hasClass("saved")?(e("#course-setup-steps").accordion("enable").accordion({active:t-1}).accordion("disable"),setTimeout(function(){var t=s.offset();e("body,html").animate({scrollTop:t.top-110,duration:200})},200),void 0):(s.effect("highlight",{color:"#ffabab",duration:300}),void 0)}),e(".chosen-select.medium").chosen({disable_search_threshold:5,width:"40%"}),e(".chosen-select.narrow").chosen({disable_search_threshold:5,width:"20%"}),e("table.course-structure-tree").treegrid({initialState:"expanded"}),e(".dateinput").datepicker({dateFormat:"yy-mm-dd"}),e(".date").click(function(){e(this).parents("div").hasClass("disabled")||e(this).find(".dateinput").datepicker("show")}),e('[name="meta_enrollment_open_ended"]').change(function(){this.checked?(e(this).parents(".enrollment-dates").find(".start-date").addClass("disabled"),e(this).parents(".enrollment-dates").find(".start-date input").attr("disabled","disabled"),e(this).parents(".enrollment-dates").find(".end-date").addClass("disabled"),e(this).parents(".enrollment-dates").find(".end-date input").attr("disabled","disabled")):(e(this).parents(".enrollment-dates").find(".start-date").removeClass("disabled"),e(this).parents(".enrollment-dates").find(".start-date input").removeAttr("disabled"),e(this).parents(".enrollment-dates").find(".end-date").removeClass("disabled"),e(this).parents(".enrollment-dates").find(".end-date input").removeAttr("disabled"))}),e('[name="meta_course_open_ended"]').change(function(){this.checked?(e(this).parents(".course-dates").find(".end-date").addClass("disabled"),e(this).parents(".course-dates").find(".end-date input").attr("disabled","disabled")):(e(this).parents(".course-dates").find(".end-date").removeClass("disabled"),e(this).parents(".course-dates").find(".end-date input").removeAttr("disabled"))}),e(".spinners").spinner(),e('[name="meta_class_limited"]').change(function(){window.console.log("yup"),window.console.log(e(this).parents(".class-size").find(".num-students")),this.checked?(window.console.log("checked"),e(this).parents(".class-size").find(".num-students").removeClass("disabled"),e(this).parents(".class-size").find(".num-students input").removeAttr("disabled")):(window.console.log("unchecked"),e(this).parents(".class-size").find(".num-students").addClass("disabled"),e(this).parents(".class-size").find(".num-students input").attr("disabled","disabled"))}),e(".coursepress-ui-toggle-switch").coursepress_ui_toggle()}function r(){e("#course-setup-steps input").on("keyup change",function(){var s=e(this).parents(".step-content")[0];e(s).find(".button.update.hidden").removeClass("hidden")}),e("#course-setup-steps select").on("change",function(){var s=e(this).parents(".step-content")[0];e(s).find(".button.update.hidden").removeClass("hidden")}),CoursePress.Events.on("editor:keyup",function(s){var t=e(s.container).parents(".step-content")[0];e(t).find(".button.update.hidden").removeClass("hidden")}),e(".step-content .button.step.prev, .step-content .button.step.next, .step-content .button.step.update, .step-content .button.step.finish").on("click",function(s){var t,r,n=jQuery(s.currentTarget);t=n.hasClass("step-1")?1:null,t=n.hasClass("step-2")?2:t,t=n.hasClass("step-3")?3:t,t=n.hasClass("step-4")?4:t,t=n.hasClass("step-5")?5:t,t=n.hasClass("step-6")?6:t,r=n.hasClass("prev")?"prev":null,r=n.hasClass("next")?"next":r,r=n.hasClass("update")?"update":r,r=n.hasClass("finish")?"finish":r,null!==t&&(e(".step-title.step-"+t).find(".status").removeClass("saved"),e(".step-title.step-"+t).find(".status").removeClass("save-error"),e(".step-title.step-"+t).find(".status").removeClass("save-attention"),e(".step-title.step-"+t).find(".status").addClass("save-process"),CoursePress.Course.get_step(t,r),CoursePress.Course.save())}),e(".button.browse-media-field").browse_media_field(),e('.step-content .course-structure input[type="checkbox"]').on("click",function(t){var r,n,a,o,i,c,u,d=t.currentTarget,p=!1,l=e(d).attr("name");if(l.match(/meta_structure_.*_units.*/g)&&(r=l.match(/meta_structure_visible_units.*/g)?"visible":"preview",n=e(e('[name="'+l+'"]').parents('tr[class*="treegrid-"]')[0]).attr("class").match(/treegrid-\d{1,10}/g)[0].trim(),a=n.split("-").pop(),o=".step-content .course-structure .treegrid-parent-"+a,i=o+' [name*="meta_structure_'+r+'_pages"]',c=e(d)[0].checked,u=e(i),e.each(u,function(s,t){e(t).prop("checked",c),n=e(e(t).parents('tr[class*="treegrid-"]')[0]).attr("class").match(/treegrid-\d{1,10}/g)[0].trim(),a=n.split("-").pop(),o=".step-content .course-structure .treegrid-parent-"+a;var i=o+' [name*="meta_structure_'+r+'_modules"]';e(i).prop("checked",c)}),p=!0),!p&&l.match(/meta_structure_.*_pages.*/g)){r=l.match(/meta_structure_visible_pages.*/g)?"visible":"preview",n=e(e('[name="'+l+'"]').parents('tr[class*="treegrid-"]')[0]).attr("class").match(/treegrid-\d{1,10}/g)[0].trim(),a=n.split("-").pop(),o=".step-content .course-structure .treegrid-parent-"+a,c=e(d)[0].checked;var _=o+' [name*="meta_structure_'+r+'_modules"]';e(_).prop("checked",c)}s()}),e(".button.instructor-assign").on("click",function(){var s=parseInt(e(e('select[name="instructors"]')[0]).val()),t=e(e('select[name="instructors"]')[0])[0].textContent;CoursePress.Course.set("action","add_instructor");var r={instructor_id:s,course_id:_coursepress.course_id,instructor_name:t,nonce:o()};CoursePress.Course.set("data",r),CoursePress.Course.save()}),n(".instructor-avatar-holder .instructor-remove a"),n(".instructor-avatar-holder .invite-remove a",!0),e(".instructor-invite input").keypress(function(s){if(13===s.which){switch(e(this).attr("name")){case"invite_instructor_first_name":e("[name=invite_instructor_last_name]").trigger("focus");break;case"invite_instructor_last_name":e("[name=invite_instructor_email]").trigger("focus");break;case"invite_instructor_email":case"invite_instructor_trigger":e("#invite-instructor-trigger").trigger("click"),e("[name=invite_instructor_first_name]").trigger("focus")}s.preventDefault()}}),e("#invite-instructor-trigger").on("click",function(){var s=e("[name=invite_instructor_email]").val(),t=e("[name=invite_instructor_first_name]").val(),r=e("[name=invite_instructor_last_name]").val(),n=null!==s.match(_coursepress.email_validation_pattern);if(n){CoursePress.Course.set("action","invite_instructor");var a={first_name:t,last_name:r,email:s,course_id:_coursepress.course_id,nonce:o()};CoursePress.Course.set("data",a),CoursePress.Course.save()}else window.console.log("DO SOMETHING TO THE UI!")}),e('[name="meta_enrollment_type"]').on("change",function(){var s=e(this).val();e(".step-content.step-6 .enrollment-type-options").addClass("hidden"),e(".step-content.step-6 .enrollment-type-options."+s).removeClass("hidden")}),e('[name="meta_payment_paid_course"]').on("change",function(){this.checked?(e(this).parents(".step-content.step-6").find(".payment-message").removeClass("hidden"),e(this).parents(".step-content.step-6").find(".is_paid_toggle").removeClass("hidden")):(e(this).parents(".step-content.step-6").find(".payment-message").addClass("hidden"),e(this).parents(".step-content.step-6").find(".is_paid_toggle").addClass("hidden"))}),e('[name="publish-course-toggle"]').on("change",function(s,t){var r=e(this).attr("data-nonce"),n="off"===t?"draft":"publish";CoursePress.Course.set("action","toggle_course_status");var a={nonce:r,status:n,state:t,course_id:_coursepress.course_id};CoursePress.Course.set("data",a),CoursePress.Course.save()}),e(".add-new-student-button").on("click",function(s){s.stopImmediatePropagation(),s.preventDefault();var t=e(this).attr("data-nonce");CoursePress.Course.set("action","enroll_student");var r={nonce:t,course_id:_coursepress.course_id,student_id:e("#student-add").val()};CoursePress.Course.set("data",r),CoursePress.Course.save()}),e("a.withdraw-student").on("click",function(){if(window.confirm(_coursepress.student_delete_confirm)){CoursePress.Course.set("action","withdraw_student");var s={student_id:e(this).attr("data-id"),course_id:_coursepress.course_id,nonce:e(this).attr("data-nonce")};CoursePress.Course.set("data",s),CoursePress.Course.save()}}),e("a.withdraw-all-students").on("click",function(){if(window.confirm(_coursepress.student_delete_all_confirm)){CoursePress.Course.set("action","withdraw_all_students");var s={course_id:_coursepress.course_id,nonce:e(this).attr("data-nonce")};CoursePress.Course.set("data",s),CoursePress.Course.save()}}),e(".coursepress_course_invite_student_wrapper input").keypress(function(s){if(13===s.which){switch(e(this).attr("name")){case"invite-firstname":e("[name=invite-lastname]").trigger("focus");break;case"invite-lastname":e("[name=invite-email]").trigger("focus");break;case"invite-email":case".coursepress_course_invite_student_wrapper .invite-submit":e(".coursepress_course_invite_student_wrapper .invite-submit").trigger("click"),e("[name=invite-firstname]").trigger("focus")}s.preventDefault()}}),e(".coursepress_course_invite_student_wrapper .invite-submit").on("click",function(){var s=e("[name=invite-email]").val(),t=e("[name=invite-firstname]").val(),r=e("[name=invite-lastname]").val(),n=null!==s.match(_coursepress.email_validation_pattern);if(n){e(".coursepress_course_invite_student_wrapper .invite-submit").prepend('<i class="fa fa-spinner fa-spin invite-progress"></i> '),CoursePress.Course.set("action","invite_student");var a={first_name:t,last_name:r,email:s,course_id:_coursepress.course_id,nonce:e(this).attr("data-nonce")};CoursePress.Course.set("data",a),CoursePress.Course.save()}e("[name=invite-email]").val(""),e("[name=invite-firstname]").val(""),e("[name=invite-lastname]").val("")})}function n(s,t){void 0===t&&(t=!1),e(s).on("click",function(s){var r,n,a=s.currentTarget;if(t){var i=e(e(a).parents(".instructor-avatar-holder")[0]).attr("id").replace("instructor_holder_","");window.confirm(_coursepress.instructor_delete_invite_confirm)&&(r=e(a).parents(".step-content")[0],e(r).find(".button.update.hidden").removeClass("hidden"),CoursePress.Course.set("action","delete_instructor_invite"),n={invite_code:i,course_id:_coursepress.course_id,nonce:o()},CoursePress.Course.set("data",n),CoursePress.Course.save())}else{var c=parseInt(e(e(a).parents(".instructor-avatar-holder")[0]).attr("id").match(/instructor_holder_\d{1,10}/g)[0].trim().split("_").pop());window.confirm(_coursepress.instructor_delete_confirm)&&(r=e(a).parents(".step-content")[0],e(r).find(".button.update.hidden").removeClass("hidden"),CoursePress.Course.set("action","delete_instructor"),n={instructor_id:c,course_id:_coursepress.course_id,nonce:o()},CoursePress.Course.set("data",n),CoursePress.Course.save())}})}function a(s){s.nonce&&e("#course-setup-steps").attr("data-nonce",s.nonce)}function o(){return e("#course-setup-steps").attr("data-nonce")}function i(){CoursePress.Course.on("coursepress:update_course_success",function(s){e(".step-title.step-"+s.last_step).find(".status").addClass("saved"),e(".step-title.step-"+s.last_step).find(".status").removeClass("save-error"),e(".step-title.step-"+s.last_step).find(".status").removeClass("save-attention"),e(".step-title.step-"+s.last_step).find(".status").removeClass("save-process"),s.next_step!==s.last_step&&e(".step-title.step-"+s.next_step).click();var t=e(".step-content.step-"+s.last_step).find(".course-step-buttons")[0];if(e("#step-done-message").remove(),e(t).append('<span id="step-done-message">&nbsp;<i class="fa fa-check"></i></span>'),e("#step-done-message").show(function(){e(this).fadeOut(1e3)}),e(t).find(".update").addClass("hidden"),e('[name="course_id"]').val(s.course_id),_coursepress.course_id=s.course_id,a(s),s.redirect){var r=location.href.replace("&tab=setup","");/\&id/.test(r)||(r+="&id="+s.course_id),/\&action=edit/.test(r)||(r+="&action=edit"),location.href=r+"&tab=units"}}),CoursePress.Course.on("coursepress:update_course_error",function(s){e(".step-title.step-"+s.last_step).find(".status").removeClass("saved"),e(".step-title.step-"+s.last_step).find(".status").addClass("save-error"),e(".step-title.step-"+s.last_step).find(".status").removeClass("save-attention"),e(".step-title.step-"+s.last_step).find(".status").removeClass("save-process"),window.console.log(s)}),CoursePress.Course.on("coursepress:add_instructor_success",function(s){var t=!0,r="";window.console.log(s);var o=_coursepress.instructor_avatars["default"];_coursepress.instructor_role_defined&&(o=_coursepress.instructor_avatars[s.instructor_id]),r+=t?'<div class="instructor-avatar-holder" id="instructor_holder_'+s.instructor_id+'"><div class="instructor-status"></div><div class="instructor-remove"><a><span class="dashicons dashicons-dismiss"></span></a></div>'+o+'<span class="instructor-name">'+s.instructor_name+'</span></div><input type="hidden" id="instructor_'+s.instructor_id+'" name="instructor[]" value="'+s.instructor_id+'" />':'<div class="instructor-avatar-holder" id="instructor_holder_'+s.instructor_id+'"><div class="instructor-status"></div>'+o+'<span class="instructor-name">'+s.instructor_name+'</span></div><input type="hidden" id="instructor_'+s.instructor_id+'" name="instructor[]" value="'+s.instructor_id+'" />',e(".instructor-avatar-holder.empty").length>0&&e(".instructor-avatar-holder.empty").detach(),0===e("#instructor_holder_"+s.instructor_id).length&&(e("#instructors-info").append(r),n("#instructor_holder_"+s.instructor_id+" .instructor-remove a")),a(s)}),CoursePress.Course.on("coursepress:delete_instructor_success",function(s){var t='<div class="instructor-avatar-holder empty"><span class="instructor-name">'+_coursepress.instructor_empty_message+"</span></div>";e("#instructor_holder_"+s.instructor_id).detach(),0===e(".instructor-avatar-holder").length&&e("#instructors-info").append(t),a(s)}),CoursePress.Course.on("coursepress:invite_instructor_success",function(s){var t=s.data.email,r=s.invite_code,o=CoursePress.utility.get_gravatar_image(t,80),i=!0,c="",u="";c+=i?'<div class="instructor-avatar-holder pending-invite" id="instructor_holder_'+r+'"><div class="instructor-status">'+_coursepress.instructor_pednding_status+'</div><div class="invite-remove"><a><span class="dashicons dashicons-dismiss"></span></a></div>'+o+'<span class="instructor-name">'+s.data.first_name+" "+s.data.last_name+"</span></div>":'<div class="instructor-avatar-holder pending-invite" id="instructor_holder_'+r+'"><div class="instructor-status">'+_coursepress.instructor_pednding_status+"</div>"+o+'<span class="instructor-name">'+s.data.first_name+" "+s.data.last_name+"</span></div>",e(".instructor-avatar-holder.empty").length>0&&e(".instructor-avatar-holder.empty").detach(),0===e("#instructor_holder_"+r).length?(e("#instructors-info").append(c),n("#instructor_holder_"+r+" .invite-remove a",!0),u=' <span class="message"><span class="dashicons dashicons-yes"></span> '+s.message.sent+"</span>"):u=' <span class="message"><span class="dashicons dashicons-yes"></span> '+s.message.exists+"</span>",e(".instructor-invite .submit-message").append(u),e(".instructor-invite .submit-message .message").fadeOut(3e3),a(s)}),CoursePress.Course.on("coursepress:invite_instructor_error",function(s){var t=' <span class="message"><span class="dashicons dashicons-yes"></span> '+s.message.send_error+"</span>";e(".instructor-invite .submit-message").append(t),e(".instructor-invite .submit-message .message").fadeOut(3e3),a(s)}),CoursePress.Course.on("coursepress:delete_instructor_invite_success",function(s){e("#instructor_holder_"+s.invite_code).detach(),a(s)}),CoursePress.Course.on("coursepress:toggle_course_status_success",function(s){e('[name="publish-course-toggle"]').attr("data-nonce",s.nonce)}),CoursePress.Course.on("coursepress:toggle_course_status_error",function(){var s=e('[name="publish-course-toggle"]');e(s).hasClass("on")?e(s).removeClass("on").addClass("off"):e(s).hasClass("off")&&e(s).removeClass("off").addClass("on")}),CoursePress.Course.on("coursepress:enroll_student_success",function(){location.reload()}),CoursePress.Course.on("coursepress:withdraw_student_success",function(){location.reload()}),CoursePress.Course.on("coursepress:withdraw_all_students_success",function(){location.reload()}),CoursePress.Course.on("coursepress:invite_student_success",function(s){e(".invite-progress").detach(),e(".coursepress_course_invite_student_wrapper .invite-submit").attr("data-nonce",s.nonce)}),CoursePress.Course.on("coursepress:invite_student_error",function(){e(".invite-progress").detach()})}function c(){function s(){var s=e(t).is(":checked"),n=e(r).is(":checked");e("tbody tr").css("display","none");var a="";n?(e("tr.treegrid-expanded ~ tr.submitted").css("display","table-row"),e("tr.treegrid-expanded ~ tr.not-submitted").css("display","none"),a=".submitted"):(e("tr.treegrid-expanded ~ tr.submitted").css("display","table-row"),e("tr.treegrid-expanded ~ tr.not-submitted").css("display","table-row")),s?(e("tr.treegrid-expanded ~ tr.ungraded"+a).css("display","table-row"),e("tr.treegrid-expanded ~ tr.graded"+a).css("display","none")):(e("tr.treegrid-expanded ~ tr.ungraded"+a).css("display","table-row"),e("tr.treegrid-expanded ~ tr.graded"+a).css("display","table-row")),e("tbody tr.student-name").css("display","table-row")}var t='.coursepress_settings_wrapper.assessment .ungraded-elements [type="checkbox"]',r='.coursepress_settings_wrapper.assessment .submitted-elements [type="checkbox"]';e(t).on("click",function(){s(this)}),e(r).on("click",function(){s(this)}),e(".coursepress_settings_wrapper.assessment table").treegrid().on("expand",function(){s(this)}),e(".coursepress_settings_wrapper.assessment table .instructor-feedback").link_popup({link_text:'<span class="dashicons dashicons-admin-comments"></span>'}),e('.coursepress_settings_wrapper.assessment [name="course-list"]').on("change",function(){var s=e(this).val();location.href=_coursepress.assessment_grid_url+"&course_id="+s}),e(".coursepress_settings_wrapper.assessment .collapse-all-students").on("click",function(){e(".coursepress_settings_wrapper.assessment table").treegrid("collapseAll")}),e(".coursepress_settings_wrapper.assessment .expand-all-students").on("click",function(){e(".coursepress_settings_wrapper.assessment table").treegrid("expandAll")})}function u(){e(".coursepress_settings_wrapper.reports .help-tooltip").link_popup({link_text:'<span class="dashicons dashicons-editor-help"></span>',offset_x:20}),e('.coursepress_settings_wrapper.reports [name="course-list"]').on("change",function(){var s=e(this).val();location.href=_coursepress.assessment_report_url+"&course_id="+s}),e(".coursepress_settings_wrapper.reports .column-report .pdf").on("click",function(){if(!e(this).data("click"))return window.alert(e(this).attr("title")),!1;var s=e(this).parents("form")[0],t=e(this).attr("data-student");e(s).find("[name=students]").val(t),s.submit()})}function d(){e('[name*="publish-notification-toggle"]').on("change",function(s,t){CoursePress.Post.prepare("update_notification","notification:"),CoursePress.Post.set("action","toggle");var r=e(this).attr("data-nonce"),n="off"===t?"draft":"publish",a=parseInt(e(this).attr("id").replace("publish-notification-toggle-","")),o={nonce:r,status:n,state:t,notification_id:a};CoursePress.Post.set("data",o),CoursePress.Post.save()}),e(".delete-notification-link").on("click",function(s){if(s.stopImmediatePropagation(),s.preventDefault(),window.confirm(_coursepress.notification_delete)){CoursePress.Post.prepare("update_notification","notification:"),CoursePress.Post.set("action","delete");var t={nonce:e(this).attr("data-nonce"),notification_id:e(this).attr("data-id")};CoursePress.Post.set("data",t),CoursePress.Post.save()}}),CoursePress.Post.on("coursepress:notification:delete_success",function(){location.reload()}),e('.coursepress_communications_wrapper.notifications [id*="doaction"]').on("click",function(){var s=e(this).siblings('[id*="bulk-action-selector"]').val();if("delete"===s&&!window.confirm(_coursepress.notification_bulk_delete))return!1;if(void 0!==s&&-1!==s){var t=[];e.each(e('[name*="bulk-actions"]'),function(s,r){e(r).is(":checked")&&t.push(e(r).val())}),CoursePress.Post.prepare("update_notification","notification:"),CoursePress.Post.set("action","bulk_"+s);var r={nonce:e(".nonce-holder").attr("data-nonce"),ids:t};CoursePress.Post.set("data",r),CoursePress.Post.save()}}),CoursePress.Post.on("coursepress:notification:bulk_publish_success",function(){location.reload()}),CoursePress.Post.on("coursepress:notification:bulk_unpublish_success",function(){location.reload()}),CoursePress.Post.on("coursepress:notification:bulk_delete_success",function(){location.reload()})}function p(){e('[name*="publish-discussion-toggle"]').on("change",function(s,t){CoursePress.Post.prepare("update_discussion","discussion:"),CoursePress.Post.set("action","toggle");var r=e(this).attr("data-nonce"),n="off"===t?"draft":"publish",a=parseInt(e(this).attr("id").replace("publish-discussion-toggle-","")),o={nonce:r,status:n,state:t,discussion_id:a};CoursePress.Post.set("data",o),CoursePress.Post.save()}),e(".delete-discussion-link").on("click",function(s){if(s.stopImmediatePropagation(),s.preventDefault(),window.confirm(_coursepress.discussion_delete)){CoursePress.Post.prepare("update_discussion","discussion:"),CoursePress.Post.set("action","delete");var t={nonce:e(this).attr("data-nonce"),discussion_id:e(this).attr("data-id")};CoursePress.Post.set("data",t),CoursePress.Post.save()}}),CoursePress.Post.on("coursepress:discussion:delete_success",function(){location.reload()}),e('.coursepress_communications_wrapper.discussions [id*="doaction"]').on("click",function(){var s=e(this).siblings('[id*="bulk-action-selector"]').val();if("delete"===s&&!window.confirm(_coursepress.discussion_bulk_delete))return!1;if(void 0!==s&&-1!==s){var t=[];e.each(e('[name*="bulk-actions"]'),function(s,r){e(r).is(":checked")&&t.push(e(r).val())}),CoursePress.Post.prepare("update_discussion","discussion:"),CoursePress.Post.set("action","bulk_"+s);var r={nonce:e(".nonce-holder").attr("data-nonce"),ids:t};CoursePress.Post.set("data",r),CoursePress.Post.save()}}),CoursePress.Post.on("coursepress:discussion:bulk_publish_success",function(){location.reload()}),CoursePress.Post.on("coursepress:discussion:bulk_unpublish_success",function(){location.reload()}),CoursePress.Post.on("coursepress:discussion:bulk_delete_success",function(){location.reload()}),e(".coursepress_communications_wrapper.discussions select#course_id").on("change",function(){var s=e(this).val();e.each(e(".coursepress_communications_wrapper.discussions select#unit_id").find("option"),function(s,t){"course"!==e(t).val()&&e(t).detach()}),CoursePress.Post.prepare("update_discussion","discussion:"),CoursePress.Post.set("action","unit_items");var t={course_id:s};CoursePress.Post.set("data",t),CoursePress.Post.save()}),CoursePress.Post.on("coursepress:discussion:unit_items_success",function(s){s.items.length>0&&e.each(s.items,function(s,t){e(".coursepress_communications_wrapper.discussions select#unit_id").append('<option value="'+t.key+'">'+t.value+"</option>")})})}CoursePress.Models=CoursePress.Models||{},CoursePress.Models.Course=CoursePress.Models.Course||Backbone.Model.extend({url:_coursepress._ajax_url+"?action=update_course",parse:function(e){!0===e.success?(this.set("response_data",e.data),this.trigger("coursepress:"+e.data.action+"_success",e.data)):(this.set("response_data",{}),this.trigger("coursepress:"+e.data.action+"_error",e.data)),CoursePress.Course.set("action","")},defaults:{}}),CoursePress.Course=new CoursePress.Models.Course,CoursePress.Models.Post=CoursePress.Models.Post||Backbone.Model.extend({url:_coursepress._ajax_url+"?action=",parse:function(e){var s=this.get("context");if(!0===e.success){void 0===e.data&&(e.data={}),this.set("response_data",e.data);var t="coursepress:"+s+e.data.action+"_success";this.trigger(t,e.data)}else 0!==e&&(this.set("response_data",{}),this.trigger("coursepress:"+s+e.data.action+"_error",e.data));CoursePress.Course.set("action","")},prepare:function(e,s){this.url=this.get("base_url")+e,void 0!==s&&this.set("context",s)},defaults:{base_url:_coursepress._ajax_url+"?action=",context:"response:"}}),CoursePress.Post=new CoursePress.Models.Post,CoursePress.Course.multiple_elements=function(s,t){var r=0;return e.each(s,function(e,s){t===s.name&&(r+=1)}),r>1},CoursePress.Course.add_array_to_data=function(s,t){var r=0,n="";e.each(t,function(e,a){var o=a.name.replace(/(\[|\]\[)/g,"/").replace(/\]/g,"");n!==o&&(r=0),o.match(/\/$/g)||CoursePress.Course.multiple_elements(t,a.name)?o.match(/\/$/g)?CoursePress.utility.update_object_by_path(s,o+r,a.value):CoursePress.utility.update_object_by_path(s,o+"/"+r,a.value):CoursePress.utility.update_object_by_path(s,o,a.value),r+=1,n=o})},CoursePress.Course.fix_step_checkboxes=function(e,s,t){return CoursePress.utility.fix_checkboxes(e,".step-content.step-"+s,t)},CoursePress.Course.get_step=function(s,t){void 0===t&&(t="next");var r,n={};n.step=s,n.is_finished=!1,s>=1&&(n.course_id=e('[name="course_id"]').val(),n.course_name=e('[name="course_name"]').val(),n.course_excerpt=tinyMCE&&tinyMCE.get("courseExcerpt")?tinyMCE.get("courseExcerpt").getContent():e('[name="course_excerpt"]').val(),r=e('.step-content.step-1 [name^="meta_"]').serializeArray(),r=CoursePress.Course.fix_step_checkboxes(r,s),CoursePress.Course.add_array_to_data(n,r)),s>=2&&(n.course_description=tinyMCE&&tinyMCE.get("courseDescription")?tinyMCE.get("courseDescription").getContent():e('[name="course_description"]').val(),r=e('.step-content.step-2 [name^="meta_"]').serializeArray(),r=CoursePress.Course.fix_step_checkboxes(r,s,"0"),CoursePress.Course.add_array_to_data(n,r)),s>=3&&(r=e('.step-content.step-3 [name^="meta_"]').serializeArray(),r=CoursePress.Course.fix_step_checkboxes(r,s,"0"),CoursePress.Course.add_array_to_data(n,r)),s>=4&&(r=e('.step-content.step-4 [name^="meta_"]').serializeArray(),r=CoursePress.Course.fix_step_checkboxes(r,s,"0"),CoursePress.Course.add_array_to_data(n,r)),s>=5&&(r=e('.step-content.step-5 [name^="meta_"]').serializeArray(),r=CoursePress.Course.fix_step_checkboxes(r,s,"0"),CoursePress.Course.add_array_to_data(n,r)),s>=6&&(r=e('.step-content.step-6 [name^="meta_"]').serializeArray(),r=CoursePress.Course.fix_step_checkboxes(r,s,"0"),CoursePress.Course.add_array_to_data(n,r));var a=s;"next"===t&&(n.meta_setup_marker=s,a=6!==a?a+1:a),"prev"===t&&(n.meta_setup_marker=s-1,a=1!==a?a-1:a),"finish"===t&&(n.meta_setup_marker=s,n.is_finished=!0),n.nonce=o(),CoursePress.Course.set("data",n),CoursePress.Course.set("action","update_course"),CoursePress.Course.set("next_step",a)},e(document).ready(function(){t(),r(),i(),c(),u(),d(),p();var e=jQuery("#course-setup-steps .step-title .status.setup_marker");e.click()})}(jQuery);